<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>流程引擎原理与实践</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?925c3dadc75643902ba1d4bef48fa406";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
        </script></script>
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="国内首本从工程角度系统性介绍流程引擎的技术体系">
    <meta name="baidu-site-verification" content="codeva-c7FETTq8fo">
    <meta name="keywords" content="开源电子书，工作流技术体系，流程引擎技术体系，工作流，流程引擎，事件驱动机制，权限系统设计，云原生工作流，Crontab工作流，工作流系统架构，流程建模，DAG，FSM，WFMC，BPMN，BPM，Airflow，OsWorkflow，Petri">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.b8820ad2.js" as="script"><link rel="preload" href="/assets/js/2.a6c4a04f.js" as="script"><link rel="preload" href="/assets/js/1.04b49174.js" as="script"><link rel="preload" href="/assets/js/33.6cb05ad6.js" as="script"><link rel="prefetch" href="/assets/js/10.01c85a43.js"><link rel="prefetch" href="/assets/js/11.36ba8367.js"><link rel="prefetch" href="/assets/js/12.49270403.js"><link rel="prefetch" href="/assets/js/13.9964bf6f.js"><link rel="prefetch" href="/assets/js/14.1ffdb2cc.js"><link rel="prefetch" href="/assets/js/15.3ec6e020.js"><link rel="prefetch" href="/assets/js/16.223f06e4.js"><link rel="prefetch" href="/assets/js/17.49a0611a.js"><link rel="prefetch" href="/assets/js/18.5e539e58.js"><link rel="prefetch" href="/assets/js/19.08beb14f.js"><link rel="prefetch" href="/assets/js/20.2fd50ddb.js"><link rel="prefetch" href="/assets/js/21.94815126.js"><link rel="prefetch" href="/assets/js/22.7335372f.js"><link rel="prefetch" href="/assets/js/23.efd43c2e.js"><link rel="prefetch" href="/assets/js/24.33511251.js"><link rel="prefetch" href="/assets/js/25.9103752e.js"><link rel="prefetch" href="/assets/js/26.be3c6fce.js"><link rel="prefetch" href="/assets/js/27.a66d9ab9.js"><link rel="prefetch" href="/assets/js/28.db24d1a7.js"><link rel="prefetch" href="/assets/js/29.e639cc41.js"><link rel="prefetch" href="/assets/js/3.8ee85a39.js"><link rel="prefetch" href="/assets/js/30.9f96cad1.js"><link rel="prefetch" href="/assets/js/31.76245b5d.js"><link rel="prefetch" href="/assets/js/32.01a0bbd7.js"><link rel="prefetch" href="/assets/js/34.370a24a6.js"><link rel="prefetch" href="/assets/js/35.83692dfe.js"><link rel="prefetch" href="/assets/js/36.c783d15a.js"><link rel="prefetch" href="/assets/js/37.ac210fe0.js"><link rel="prefetch" href="/assets/js/38.07dc64eb.js"><link rel="prefetch" href="/assets/js/39.4ef28dca.js"><link rel="prefetch" href="/assets/js/4.9d17ba4d.js"><link rel="prefetch" href="/assets/js/40.a8fcb556.js"><link rel="prefetch" href="/assets/js/41.98d7d1f0.js"><link rel="prefetch" href="/assets/js/42.e31dd182.js"><link rel="prefetch" href="/assets/js/43.822702b0.js"><link rel="prefetch" href="/assets/js/44.50c68594.js"><link rel="prefetch" href="/assets/js/45.4e32699e.js"><link rel="prefetch" href="/assets/js/46.09f04e77.js"><link rel="prefetch" href="/assets/js/47.35c13096.js"><link rel="prefetch" href="/assets/js/48.99dfb60f.js"><link rel="prefetch" href="/assets/js/49.e1984c48.js"><link rel="prefetch" href="/assets/js/5.5682b71e.js"><link rel="prefetch" href="/assets/js/50.4242e15e.js"><link rel="prefetch" href="/assets/js/51.bdee7514.js"><link rel="prefetch" href="/assets/js/52.3b23c6f4.js"><link rel="prefetch" href="/assets/js/53.b6798440.js"><link rel="prefetch" href="/assets/js/54.ac356f09.js"><link rel="prefetch" href="/assets/js/55.79840f1c.js"><link rel="prefetch" href="/assets/js/56.343306c2.js"><link rel="prefetch" href="/assets/js/57.90f7511a.js"><link rel="prefetch" href="/assets/js/58.59457ff7.js"><link rel="prefetch" href="/assets/js/59.a05e2b0c.js"><link rel="prefetch" href="/assets/js/6.6aa986f5.js"><link rel="prefetch" href="/assets/js/60.7d6e698d.js"><link rel="prefetch" href="/assets/js/61.d1952570.js"><link rel="prefetch" href="/assets/js/62.a15b1cb5.js"><link rel="prefetch" href="/assets/js/63.69030ee5.js"><link rel="prefetch" href="/assets/js/64.a60b63a8.js"><link rel="prefetch" href="/assets/js/65.c1986cb9.js"><link rel="prefetch" href="/assets/js/66.e5747c76.js"><link rel="prefetch" href="/assets/js/67.c7de5e6a.js"><link rel="prefetch" href="/assets/js/68.96f4e3c6.js"><link rel="prefetch" href="/assets/js/69.db66370e.js"><link rel="prefetch" href="/assets/js/7.1fb8aaeb.js"><link rel="prefetch" href="/assets/js/70.8962d544.js"><link rel="prefetch" href="/assets/js/71.695bacdf.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.7bd035a8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.png" alt="流程引擎原理与实践" class="logo"> <span class="site-name can-hide">流程引擎原理与实践</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="目录" class="dropdown-title"><span class="title">目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="目录" class="mobile-dropdown-title"><span class="title">目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/1-引言.html" class="nav-link">
  1 引言
</a></li><li class="dropdown-item"><!----> <a href="/2-概念.html" class="nav-link">
  2 概念
</a></li><li class="dropdown-item"><!----> <a href="/3-流程建模和解析.html" class="nav-link">
  3 流程建模和解析
</a></li><li class="dropdown-item"><!----> <a href="/4-流程引擎的核心组件.html" class="nav-link">
  4 流程引擎的核心组件
</a></li><li class="dropdown-item"><!----> <a href="/5-事件驱动机制.html" class="nav-link">
  5 事件驱动机制
</a></li><li class="dropdown-item"><!----> <a href="/6-核心表结构与接口设计.html" class="nav-link">
  6 核心表结构与接口设计
</a></li><li class="dropdown-item"><!----> <a href="/7-权限系统设计.html" class="nav-link">
  7 权限系统设计
</a></li><li class="dropdown-item"><!----> <a href="/8-分布式Crontab任务调度.html" class="nav-link">
  8 分布式Crontab任务调度
</a></li><li class="dropdown-item"><!----> <a href="/9-流程分析.html" class="nav-link">
  9 流程分析
</a></li><li class="dropdown-item"><!----> <a href="/10-云原生工作流.html" class="nav-link">
  10 云原生工作流
</a></li><li class="dropdown-item"><!----> <a href="/11-多引擎分布式系统实现.html" class="nav-link">
  11 多引擎分布式系统实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="帮助" class="dropdown-title"><span class="title">帮助</span> <span class="arrow down"></span></button> <button type="button" aria-label="帮助" class="mobile-dropdown-title"><span class="title">帮助</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  关于
</a></li><li class="dropdown-item"><!----> <a href="/sponsor.html" class="nav-link">
  打赏赞助
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/guanchao/workflow-engine-book" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="目录" class="dropdown-title"><span class="title">目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="目录" class="mobile-dropdown-title"><span class="title">目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/1-引言.html" class="nav-link">
  1 引言
</a></li><li class="dropdown-item"><!----> <a href="/2-概念.html" class="nav-link">
  2 概念
</a></li><li class="dropdown-item"><!----> <a href="/3-流程建模和解析.html" class="nav-link">
  3 流程建模和解析
</a></li><li class="dropdown-item"><!----> <a href="/4-流程引擎的核心组件.html" class="nav-link">
  4 流程引擎的核心组件
</a></li><li class="dropdown-item"><!----> <a href="/5-事件驱动机制.html" class="nav-link">
  5 事件驱动机制
</a></li><li class="dropdown-item"><!----> <a href="/6-核心表结构与接口设计.html" class="nav-link">
  6 核心表结构与接口设计
</a></li><li class="dropdown-item"><!----> <a href="/7-权限系统设计.html" class="nav-link">
  7 权限系统设计
</a></li><li class="dropdown-item"><!----> <a href="/8-分布式Crontab任务调度.html" class="nav-link">
  8 分布式Crontab任务调度
</a></li><li class="dropdown-item"><!----> <a href="/9-流程分析.html" class="nav-link">
  9 流程分析
</a></li><li class="dropdown-item"><!----> <a href="/10-云原生工作流.html" class="nav-link">
  10 云原生工作流
</a></li><li class="dropdown-item"><!----> <a href="/11-多引擎分布式系统实现.html" class="nav-link">
  11 多引擎分布式系统实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="帮助" class="dropdown-title"><span class="title">帮助</span> <span class="arrow down"></span></button> <button type="button" aria-label="帮助" class="mobile-dropdown-title"><span class="title">帮助</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  关于
</a></li><li class="dropdown-item"><!----> <a href="/sponsor.html" class="nav-link">
  打赏赞助
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/guanchao/workflow-engine-book" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>第一部份：流程引擎基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/1-引言.html" class="sidebar-link">1 引言</a></li><li><a href="/2-概念.html" class="sidebar-link">2 概念</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>3 流程建模和解析</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/3.1-流程建模语言发展概述.html" class="sidebar-link">3.1 流程建模语言发展概述</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>3.2 流程建模</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/3.2-流程建模-流程定义.html" class="active sidebar-link">流程定义</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3.2-流程建模-流程定义.html#流程定义" class="sidebar-link">流程定义</a></li><li class="sidebar-sub-header"><a href="/3.2-流程建模-流程定义.html#workflow定义" class="sidebar-link">workflow定义</a></li><li class="sidebar-sub-header"><a href="/3.2-流程建模-流程定义.html#node节点定义" class="sidebar-link">node节点定义</a></li><li class="sidebar-sub-header"><a href="/3.2-流程建模-流程定义.html#runtime定义" class="sidebar-link">runtime定义</a></li></ul></li><li><a href="/3.2-流程建模-事件节点定义.html" class="sidebar-link">事件节点定义</a></li><li><a href="/3.2-流程建模-任务节点定义.html" class="sidebar-link">任务节点定义</a></li><li><a href="/3.2-流程建模-网关节点定义.html" class="sidebar-link">网关节点定义</a></li></ul></section></li><li><a href="/3.3-生命周期.html" class="sidebar-link">3.3 生命周期</a></li><li><a href="/3.4-流程模型的解析.html" class="sidebar-link">3.4 流程模型的解析</a></li><li><a href="/3.5-与BPMN的比较.html" class="sidebar-link">3.5 与BPMN的比较</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第二部份：流程引擎实现</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第三部份：流程引擎进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>流程建模这部分内容，我会从流程定义、事件节点定义、任务节点定义和网关节点定义四大部分来展开介绍。让你了解如何设计一个流程建模语言，包括工作流的定义、节点的定义和分类（事件、任务和网关）、运行时数据的定义以及事件类型定义；</p> <p>流程定义这一节内容，主要介绍工作流、节点和运行时数据的JSON结构怎么设计。</p> <h2 id="流程定义"><a href="#流程定义" class="header-anchor">#</a> 流程定义</h2> <p>传统BPMN采用XML的语言来定义流程，虽然描述很完整，但是其描述复杂，比较难上手理解。</p> <p>区别于传统做法，我们采用Json这种互联网上更通用的格式来定义流程，这种数据格式在系统之间也更容易传递交互、更容易理解。</p> <p>如下是，一个完整的工作流定义。</p> <p>需要注意，workflow流程定义是一个静态数据，其运行时的数据execution，即流程实例则是动态数据。一个流程（workflow）被执行时，会产生流程实例（execution），这个流程实例也会包含流程定义的结构，同时也包含此次运行时的数据，他们是一对多的关系。</p> <p>以下数据工作流定义的字段结构：</p> <h2 id="workflow定义"><a href="#workflow定义" class="header-anchor">#</a> workflow定义</h2> <table><thead><tr><th>属性</th> <th>说明</th> <th>是否必须</th></tr></thead> <tbody><tr><td>id</td> <td>工作流ID，唯一标识工作流的身份</td> <td>是</td></tr> <tr><td>name</td> <td>工作流名称</td> <td>是</td></tr> <tr><td>description</td> <td>工作流描述</td> <td>否</td></tr> <tr><td>version</td> <td>工作流版本</td> <td>否</td></tr> <tr><td>startTaskInstId</td> <td>工作流开始运行的节点。默认为空，表示从流程实例的节点开始运行。</td> <td>否</td></tr> <tr><td>endTaskInstId</td> <td>工作流运行结束时的节点。默认为空，表示运行到流程实例结束为止。</td> <td>否</td></tr> <tr><td>engine</td> <td>引擎类型，支持：快速模式(fast)、标准模式(standard)，默认是标准模式。两者区别见《引擎执行模式》一节内容。</td> <td>是</td></tr> <tr><td>status</td> <td>工作流状态，状态轮转见后面内容。</td> <td>是</td></tr> <tr><td>creator</td> <td>工作流创建人</td> <td>是</td></tr> <tr><td>executor</td> <td>工作流执行触发人</td> <td>否</td></tr> <tr><td>timeout</td> <td>工作流执行的超时时间，默认为0表示没有时间限制。</td> <td>否</td></tr> <tr><td>inputDataSchema</td> <td>声明和验证工作流的输入数据。</td> <td>否</td></tr> <tr><td>outputDataSchema</td> <td>声明和验证工作流的输出数据</td> <td>否</td></tr> <tr><td>error</td> <td>工作流执行的错误信息</td> <td>否</td></tr> <tr><td>extension</td> <td>扩展字段可以用来设置并发限制等附加信息，以此来增强工作流的定义</td> <td>否</td></tr> <tr><td>metadata</td> <td>元数据主要用来存储工作流核心定义之外的信息，例如作者邮件、环境信息、分类等</td> <td>否</td></tr> <tr><td>nodes</td> <td>node节点数组</td> <td>是</td></tr></tbody></table> <p>其Json结构参考如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1541815603606036480&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Unknown&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;startTaskInstId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;endTaskInstId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;engine&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fast&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;creator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;executor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timeout&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;inputDataSchema&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;string_value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
            <span class="token property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;outputDataSchema&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;string_value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
            <span class="token property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;extension&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;rateLimit&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;metadata&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxx@qq.com&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;nodes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;instId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;脚本任务执行&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;task&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;执行脚本任务&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;template&quot;</span><span class="token operator">:</span> <span class="token string">&quot;script&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;positions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;connections&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;代码&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;errorHandler&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;loopHandler&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;timeout&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;isIgnore&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">&quot;runtimes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;startAt&quot;</span><span class="token operator">:</span> <span class="token number">1700063265000</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;endAt&quot;</span><span class="token operator">:</span> <span class="token number">1700063307000</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;done&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;input&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxx&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;output&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ok&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>各个属性介绍如下：</p> <blockquote><p>id</p></blockquote> <p>工作流的ID，可以使用数据库的自增长生成的唯一ID，也可以使用类似UUID算法或者twitter的雪花算法生成唯一的ID。</p> <blockquote><p>name</p></blockquote> <p>工作流名称。</p> <blockquote><p>description</p></blockquote> <p>可用于提供有关工作流的更多信息。</p> <blockquote><p>version</p></blockquote> <p>可以指定工作流的具体版本，版本格式采用通用的格式：主版本号.次版本号.修订号，版本号递增规则如下：。</p> <ul><li><p>主版本号：当出现不兼容的大版本变动</p></li> <li><p>次版本号：当做了向下兼容的功能性新增</p></li> <li><p>修订号：当做了向下兼容的问题修正</p></li></ul> <blockquote><p>startTaskInstId</p></blockquote> <p>指定工作流执行时起始运行节点，默认情况下为空表示由默认的起始节点开始。</p> <blockquote><p>endTaskInstId</p></blockquote> <p>指定工作流执行的终止节点，即执行到该节点，则停止执行。</p> <blockquote><p>engine</p></blockquote> <p>工作流运行时选择使用的引擎类型，分别有快速模式和标准模式。两种模式执行有区别，快速模式适合执行时间短、运行速度快、任务量大的业务流程，例如API服务等。标准模式适合长时间运行的业务流程，例如审批等。两者的具体在下一章会详细介绍。</p> <blockquote><p>status</p></blockquote> <p>表示工作流的运行状态，详细见下一章流程实例生命周期介绍：</p> <img src="/assets/img/3 流程的生命周期.cdbfc72f.png" alt="image-20240304094655399" style="zoom:50%;"> <blockquote><p>creator</p></blockquote> <p>表示工作流的创建人。</p> <blockquote><p>executor</p></blockquote> <p>表示触发工作流执行的人，例如在表单提交时可以通过登录态获取提交表单的用户，默认则是工作流创建人。</p> <blockquote><p>timeout</p></blockquote> <p>指定工作流运行的最长时间，超过该时间后，引擎会强制终止流程中所有运行中的任务实例，并将status字段设置为已停止状态。</p> <blockquote><p>inputDataSchema</p></blockquote> <p>用于声明和验证工作流接收的参数类型，如果不符合声明的要求，则无法触发工作流运行。其格式参考如下。</p> <p>主要定义输入参数的类型，包括基本的字符串（string）、整数（integer）、浮点数（float）、布尔值（boolean），以及默认值、是否必填等校验信息。这样可以在触发工作流运行之前，检查输入参数是否符合要求。这个在设计API类型的工作流时用的最多。例如下面的例子：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;input_string_value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;input_integer_value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;input_float_value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;float&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;input_boolean_value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>outputDataSchema</p></blockquote> <p>功能跟inputDataSchema类型，主要用于声明校验工作流的输出结果。如果不符合声明的要求，则会导致报错信息（存储在error字段），并修改status状态为错误。</p> <blockquote><p>error</p></blockquote> <p>记录工作流在运行时发生异常的错误信息，可用于排查故障。</p> <blockquote><p>extension</p></blockquote> <p>该属性用于增强扩充工作流功能的定义，例如设置工作流的并发度，或者设置工作流的运行KPI指标等信息。</p> <p>例如下面定义了每秒钟该工作流同时能触发运行的工作流实例个数，类似于API限频控制每秒并发数。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;rateLimit&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span>
</code></pre></div><blockquote><p>metadata</p></blockquote> <p>该属性存储一些工作流的元数据，这些元数据不影响工作流的运行，例如工作流创建者的联系方式等信息。</p> <p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>{&quot;email&quot;:&quot;xxx@qq.com&quot;}
</code></pre></div><h2 id="node节点定义"><a href="#node节点定义" class="header-anchor">#</a> node节点定义</h2> <p>如下图所示，是BPMN建模语言中包含的各种基础元素，包括任务、事件以及网关元素。BPMN建模语言虽然描述的元素非常丰富全面，但我们在实际的使用过程中，发现绝大部分元素是几乎用不到的。本着二八原则和实用角度出发，我们对BPMN的任务、事件和网关元素进行了精简，剥离出使用最频繁的元素进行定义总结。</p> <img src="/assets/img/3.2 bpmn-events.1f2161db.png" style="zoom:150%;"> <p>下面构成一个流程的四个基础元素：</p> <table><thead><tr><th><strong>元素</strong></th> <th><strong>符号</strong></th> <th><strong>描述</strong></th></tr></thead> <tbody><tr><td>任务（Task）</td> <td><img src="data:image/png;base64,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" alt="BPMN symbol - Task"></td> <td>流程中执行具体任务的节点</td></tr> <tr><td>事件（Event）</td> <td><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH4wkXBRA2H2mL+AAAAAd0RVh0QXV0aG9yAKmuzEgAAAAMdEVYdERlc2NyaXB0aW9uABMJISMAAAAKdEVYdENvcHlyaWdodACsD8w6AAAADnRFWHRDcmVhdGlvbiB0aW1lADX3DwkAAAAJdEVYdFNvZnR3YXJlAF1w/zoAAAALdEVYdERpc2NsYWltZXIAt8C0jwAAAAh0RVh0V2FybmluZwDAG+aHAAAAB3RFWHRTb3VyY2UA9f+D6wAAAAh0RVh0Q29tbWVudAD2zJa/AAAABnRFWHRUaXRsZQCo7tInAAAClElEQVQ4ja3UT0iTYQDH8a+vDlFIy6GBm6N6DQqrJWxvZXSptl4vIbwSpUXQIVkdKkoPUdKhwhTKLqmH0KUolqtAoc11iMI/LV0tssCUajkjbJYFSX/06RCZ5h8w970+vB+e5/D+EDM0Ln6Ke/4mceikJtZYTSLFkCAAkWJIFGZlpTh+qkA8fuKf6VMhhBBRQgjBpLp7PRQWFfKs6zVq3lqy1HSWpiWSbFjEUOgL79+O0O7uw1Pfg6JYKS+rRJblyQSTUIGz5RzHDpSw5+gGch1WdLHRzNaPb2M0VTyi8bKfOmc9qpo9Ha1pPsuJgxc416CRoRhmxf6txxeiOK+Zmqt1ZGdn/0W7ez3Yt2icb8ydFzgZPr27hY62h8iyTNS4+Cm25WSyWklmz9GN8wb/dKP8KQPdOlyum0j3H9/muf8NuQ7rf4MAOY4MfF2dBAIBouP1Y2eMq+JQbCsWhEbHSIx+iCX4Moz04G4Xm9T0BYF/UtQ0vF4v0ru3w6QuXxIRNGVZLMFgEGlkeJREfVxE0ER9POFwGGlxUjwj4dGIoF+HJfR6PVKqaSmDrz5GBB1+HYXJZELabttKh7svIqjPE8RmsyHtzS3g7vUX/Pg2tiBQ+p7ArQYvmqYhrTdnYrFYaKp4tCDUWzWExWLBbDYTA1BeVsnGzVbWZaX9178/5E+m4lIJbW1tv28NIMsy16rrKM5rpscXmjd4eFcp1dXVE7s6ZaTdbjf79ueTdySLHEfGnHsqfU/AWzXElYu1OJ1OVFWdOJu2/P39/RQVFdLpa2dnfhbKDiNJRh0phgQ+DY7zOaSj0xOkqfYOiqJQWlo61/JPLRAI4HK5aG1tJRQKMTAwgNFoxGAwYLfb0TQNs9k84yt+Ac1RMTuHwJIUAAAAAElFTkSuQmCC" alt="BPMN symbol - Start event" style="zoom:150%;"></td> <td>在流程实例运行过程中发生的事件，例如开始、结束等</td></tr> <tr><td>网关（Gateway）</td> <td><img src="data:image/png;base64,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" alt="BPMN symbol - symbol" style="zoom:150%;"></td> <td>控制流程的数据流转和路由决策方向</td></tr> <tr><td>箭头（Flow）</td> <td><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAAAJCAYAAABt/EFEAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH4wkXBREU0xL7XQAAAAd0RVh0QXV0aG9yAKmuzEgAAAAMdEVYdERlc2NyaXB0aW9uABMJISMAAAAKdEVYdENvcHlyaWdodACsD8w6AAAADnRFWHRDcmVhdGlvbiB0aW1lADX3DwkAAAAJdEVYdFNvZnR3YXJlAF1w/zoAAAALdEVYdERpc2NsYWltZXIAt8C0jwAAAAh0RVh0V2FybmluZwDAG+aHAAAAB3RFWHRTb3VyY2UA9f+D6wAAAAh0RVh0Q29tbWVudAD2zJa/AAAABnRFWHRUaXRsZQCo7tInAAAA1klEQVRIieWTIQ6DQBREZ5cmiwIEAkeQewT8Ki5AgkeA4xxcBo3gEis4BAKLmwpKmjZtHZDQl3zx85+YzGbBC6OUojGG1tqfHg7KcwoACICO41Brza7rPnsH5zqUrYRtpJQMw5Bt23JZlqd3YsbdeS9hGyEEXddlWZacponicfhbgiDAbS3smgghXnbP82CMwTzPGMcRdV2jqioIXriFrYQ4jpGmKay1kFKiaRoURQGl1Cqe/G13BQDzPGcURcyyjH3ff/Ru573T/iRJAt/3MQwDtNZfvTvngN/e1HLDrAAAAABJRU5ErkJggg==" alt="BPMN symbol - flow" style="zoom:150%;"></td> <td>箭头用于说明节点之间的流向以及依赖关系，这里直接用connections定义</td></tr></tbody></table> <p>下面是节点的各字段定义：</p> <p>备注：在这里，我们把前面任务、事件和网关三个基础元素都统一用node节点来定义JSON结构，其区别通过type字段来标识，不同类型的节点，其区别在parameters里体现。</p> <table><thead><tr><th>属性</th> <th>说明</th> <th>是否必须</th></tr></thead> <tbody><tr><td>instId</td> <td>流程中每个节点都有唯一的id来标识</td> <td>是</td></tr> <tr><td>name</td> <td>节点名称</td> <td>是</td></tr> <tr><td>type</td> <td>节点类型，包括：任务（Task）、事件（Event）和网关（Gateway）</td> <td>是</td></tr> <tr><td>description</td> <td>节点描述</td> <td>否</td></tr> <tr><td>template</td> <td>节点模板，不同模板类型的节点代表执行不同的功能</td> <td>是</td></tr> <tr><td>positions</td> <td>节点在流程设计器平面上的x、y坐标位置</td> <td>是</td></tr> <tr><td>connections</td> <td>当前节点指向的下一个节点（大于等于0），最后的叶子节点为空数组</td> <td>否</td></tr> <tr><td>parameters</td> <td>不同节点模板，其输入参数不一样，是一个Json的结构的对象。</td> <td>是</td></tr> <tr><td>errorHandler</td> <td>错误处理器</td> <td>否</td></tr> <tr><td>loopHandler</td> <td>循环处理器</td> <td>否</td></tr> <tr><td>timeout</td> <td>节点运行的最大时长</td> <td></td></tr> <tr><td>isIgnore</td> <td>当前节点是否忽略运行。如果设置为true，则运行时，引擎会检测到该标识并跳过该节点不执行，接着执行下一个节点</td> <td>否</td></tr> <tr><td>runtimes</td> <td>运行时数据，它是一个runtime结构体数组。每个runtime包括运行时间、运行时的入参数据、输出结果等</td> <td>是</td></tr></tbody></table> <p>其Json结构参考如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;instId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;脚本任务执行&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Task&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;执行脚本任务&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;template&quot;</span><span class="token operator">:</span> <span class="token string">&quot;script&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;positions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;connections&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;代码&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;errorHandler&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;loopHandler&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timeout&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;isIgnore&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;runtimes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>同样的，这里节点(node)定义是静态数据，其运行时会产生节点实例这种动态数据（nodeInst），每个节点实例都会包含节点定义的数据结构，也包含运行时的数据。两者也是一对多的关系。</p> <blockquote><p>instId</p></blockquote> <p>任务的实例ID，流程中每个节点的实例ID都是唯一的，可以采用UUID算法生成或者使用twitter的雪花算法生成，这里推荐后者。因为雪花算法生成的ID唯一且成增长趋势，可以避免ID随机导致的数据库主键插入顺序频繁排序引致的低效率问题，而且也方便后续分表时作为全局唯一的分布式主键ID。</p> <blockquote><p>name</p></blockquote> <p>描述节点名称</p> <blockquote><p>type</p></blockquote> <p>描述节点类型，包括：任务（Task）、事件（Event）和网关（Gateway）</p> <blockquote><p>description</p></blockquote> <p>描述节点的功能</p> <blockquote><p>template</p></blockquote> <p>节点的类型，包括：起始节点、节点、数据流控制节点三大类，更具体可以参考下一章内容。</p> <blockquote><p>positions</p></blockquote> <p>描述节点在流程设计器上坐标位置，主要用于在浏览器上图形化渲染展示。</p> <blockquote><p>connections</p></blockquote> <p>当前节点指向的下一个节点实例ID，如果数组有多个实例ID，则可能是并行节点。如果是流程的叶子节点，即最后一个节点，则该属性为空数组。</p> <blockquote><p>parameters</p></blockquote> <p>定义当前节点的入参属性，采用字典结构，每个入参key属性对应label、type、value、default、required五个字段，例如下面的json结构。</p> <ul><li><p>label</p> <p>描述入参的名称</p></li> <li><p>type</p> <p>描述入参的类型，包括：字符串（string）、整数（integer）、浮点数（float）、布尔值（boolean）等</p></li> <li><p>key</p> <p>描述入参的唯一key值标识。注意节点中的parameters数组里的成员每个key值都是不重复的，这个主要用于定位表示字段的位置。在后面介绍的变量表达式中也会用到，用于引擎在运行时定位节点的参数位置。</p></li> <li><p>value</p> <p>描述入参的值。</p></li> <li><p>default</p> <p>描述入参的默认值。</p></li> <li><p>required</p> <p>描述入参是否必填</p></li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;名字&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;无&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;年龄&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>errorHandler 错误节点</p></blockquote> <p>其JSON结构如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;operation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;stop&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;retryCount&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;retryInterval&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;exception_branch&quot;</span><span class="token operator">:</span><span class="token string">&quot;xxx&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中operation字段支持的动作包括：</p> <ul><li>stop：发生错误，则直接停止往下执行</li> <li>ignore：发生错误，忽略，继续往下执行</li> <li>catch：发生错误，捕获并响应，执行异常分支的流程（exception_branch分支指向的节点）</li> <li>retry：发生错误，重试retryCount次，每次之间间隔是retryInterval秒</li></ul> <blockquote><p>loopHandler循环处理器</p></blockquote> <p>其JSON结构如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;loopType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;for&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;maxIteration&quot;</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token property">&quot;stopCond&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;value1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;operation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;equal&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;value2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中loopType支持for循环和do...while循环</p> <p>两种循环模式都支持设置最大循环次数maxIteration。</p> <p>其中do...while循环需要设置循环终止的条件，即stopCond字段。</p> <p>终止条件的判断支持常见的字符串、数字对比方式。</p> <blockquote><p>timeout</p></blockquote> <p>设置当前节点运行的最长时间，超过该时间，引擎会强制终止，并设置当前任务实例为超时状态。</p> <blockquote><p>isIgnore</p></blockquote> <p>设置当前节点在运行时是否要忽略不执行，直接运行下一个节点。这个功能一般用在调试的时候用。</p> <blockquote><p>runtimes</p></blockquote> <p>节点的运行时数据，如果节点被多次运行，则会生成多个runtime结构体数据，详细见下面介绍。</p> <h2 id="runtime定义"><a href="#runtime定义" class="header-anchor">#</a> runtime定义</h2> <table><thead><tr><th>属性</th> <th>说明</th></tr></thead> <tbody><tr><td>index</td> <td>索引位置。由于流程中一个节点可能被执行多次（例如审批打回或循环），这里通过index递增来区分不同task实例，它是依次递增的。</td></tr> <tr><td>startAt</td> <td>任务实例运行开始时间</td></tr> <tr><td>endAt</td> <td>任务实例运行结束时间</td></tr> <tr><td>status</td> <td>任务实例的状态</td></tr> <tr><td>error</td> <td>任务实例运行时发生异常时的错误信息</td></tr> <tr><td>input</td> <td>运行时的入参数据，跟task结构体的parameters一一对应，是key、value的字典结构。前面node节点定义中的parameters是<strong>定义时的静态数据</strong>，可能是常量、也可能是变量表达式（运行时解析）。而这里的input则是节点<strong>运行时的动态数据</strong>，可能是常量、也可能是变量表达式运行时解析后的数据。两种是一个静态、一个动态数据的区别。</td></tr> <tr><td>output</td> <td>任务实例运行时的输出结果。其数据类型可以是字符串、数字、布尔值、数组、或复杂的对象结构。</td></tr></tbody></table> <p>其Json结构参考如下：</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;index&quot;: 0,
    &quot;startAt&quot;: 1700063265000,
    &quot;endAt&quot;: 1700063307000,
    &quot;status&quot;: &quot;done&quot;,
    &quot;error&quot;: &quot;&quot;,
    &quot;input&quot;: {
        &quot;code&quot;: &quot;xxx&quot;
    },
    &quot;output&quot;: &quot;ok&quot;
}
</code></pre></div><blockquote><p>index</p></blockquote> <p>描述任务实例运行的顺序，如果节点只运行一次，则index为0，即第一个被运行的任务实例。如果节点被多次运行，例如在审批打回或者循环的场景，则index依次递增。也就是说，runtime这里存储的是任务的运行时数据，即任务实例，这里可以是多个。</p> <blockquote><p>startAt</p></blockquote> <p>任务实例开始运行的时间，格式采用UNIX毫秒时间戳。</p> <blockquote><p>endAt</p></blockquote> <p>任务实例运行结束的时间，格式采用UNIX毫秒时间戳。跟startAt相减可以精确计算出任务实例毫秒级的运行耗时。</p> <blockquote><p>status</p></blockquote> <p>任务实例的状态，详细见下一章任务实例生命周期的介绍。</p> <img src="/assets/img/3 任务的生命周期.457a4900.png" alt="image-20240304093637277"> <blockquote><p>input</p></blockquote> <p>任务实例运行时的入参数据，这里跟task结构体的parameters一一对应。</p> <p>例如task的parameters定义如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;名字&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;无&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;年龄&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>那么任务实例在运行时的input结构如下，采用key、value的字典结构。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">}</span>
</code></pre></div><p>之所以还要记录任务实例运行时的入参数据，主要是因为在定义task任务的parameters时，它的参数value可以是变量表达式的形式，即在运行时根据上下文数据动态解析，并不是都是固定常量。</p> <blockquote><p>output</p></blockquote> <p>任务实例运行的输出，其数据类型可以是字符串、数字、布尔值、数组、或复杂的对象结构。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">7/21/2024, 9:20:19 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/3.1-流程建模语言发展概述.html" class="prev">
        3.1 流程建模语言发展概述
      </a></span> <span class="next"><a href="/3.2-流程建模-事件节点定义.html">
        事件节点定义
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b8820ad2.js" defer></script><script src="/assets/js/2.a6c4a04f.js" defer></script><script src="/assets/js/1.04b49174.js" defer></script><script src="/assets/js/33.6cb05ad6.js" defer></script>
  </body>
</html>
