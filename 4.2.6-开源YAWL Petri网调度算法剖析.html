<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>流程引擎原理与实践</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?925c3dadc75643902ba1d4bef48fa406";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
        </script></script>
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="国内首本从工程角度系统性介绍流程引擎的技术体系">
    <meta name="baidu-site-verification" content="codeva-c7FETTq8fo">
    <meta name="keywords" content="开源电子书，工作流技术体系，流程引擎技术体系，工作流，流程引擎，事件驱动机制，权限系统设计，云原生工作流，Crontab工作流，工作流系统架构，流程建模，DAG，FSM，WFMC，BPMN，BPM，Airflow，OsWorkflow，Petri">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.b8820ad2.js" as="script"><link rel="preload" href="/assets/js/2.a6c4a04f.js" as="script"><link rel="preload" href="/assets/js/1.04b49174.js" as="script"><link rel="preload" href="/assets/js/11.36ba8367.js" as="script"><link rel="prefetch" href="/assets/js/10.01c85a43.js"><link rel="prefetch" href="/assets/js/12.49270403.js"><link rel="prefetch" href="/assets/js/13.9964bf6f.js"><link rel="prefetch" href="/assets/js/14.1ffdb2cc.js"><link rel="prefetch" href="/assets/js/15.3ec6e020.js"><link rel="prefetch" href="/assets/js/16.223f06e4.js"><link rel="prefetch" href="/assets/js/17.49a0611a.js"><link rel="prefetch" href="/assets/js/18.5e539e58.js"><link rel="prefetch" href="/assets/js/19.08beb14f.js"><link rel="prefetch" href="/assets/js/20.2fd50ddb.js"><link rel="prefetch" href="/assets/js/21.94815126.js"><link rel="prefetch" href="/assets/js/22.7335372f.js"><link rel="prefetch" href="/assets/js/23.efd43c2e.js"><link rel="prefetch" href="/assets/js/24.33511251.js"><link rel="prefetch" href="/assets/js/25.9103752e.js"><link rel="prefetch" href="/assets/js/26.be3c6fce.js"><link rel="prefetch" href="/assets/js/27.a66d9ab9.js"><link rel="prefetch" href="/assets/js/28.db24d1a7.js"><link rel="prefetch" href="/assets/js/29.e639cc41.js"><link rel="prefetch" href="/assets/js/3.8ee85a39.js"><link rel="prefetch" href="/assets/js/30.9f96cad1.js"><link rel="prefetch" href="/assets/js/31.76245b5d.js"><link rel="prefetch" href="/assets/js/32.01a0bbd7.js"><link rel="prefetch" href="/assets/js/33.6cb05ad6.js"><link rel="prefetch" href="/assets/js/34.370a24a6.js"><link rel="prefetch" href="/assets/js/35.83692dfe.js"><link rel="prefetch" href="/assets/js/36.c783d15a.js"><link rel="prefetch" href="/assets/js/37.ac210fe0.js"><link rel="prefetch" href="/assets/js/38.07dc64eb.js"><link rel="prefetch" href="/assets/js/39.4ef28dca.js"><link rel="prefetch" href="/assets/js/4.9d17ba4d.js"><link rel="prefetch" href="/assets/js/40.a8fcb556.js"><link rel="prefetch" href="/assets/js/41.98d7d1f0.js"><link rel="prefetch" href="/assets/js/42.e31dd182.js"><link rel="prefetch" href="/assets/js/43.822702b0.js"><link rel="prefetch" href="/assets/js/44.50c68594.js"><link rel="prefetch" href="/assets/js/45.4e32699e.js"><link rel="prefetch" href="/assets/js/46.09f04e77.js"><link rel="prefetch" href="/assets/js/47.35c13096.js"><link rel="prefetch" href="/assets/js/48.99dfb60f.js"><link rel="prefetch" href="/assets/js/49.e1984c48.js"><link rel="prefetch" href="/assets/js/5.5682b71e.js"><link rel="prefetch" href="/assets/js/50.4242e15e.js"><link rel="prefetch" href="/assets/js/51.bdee7514.js"><link rel="prefetch" href="/assets/js/52.3b23c6f4.js"><link rel="prefetch" href="/assets/js/53.b6798440.js"><link rel="prefetch" href="/assets/js/54.ac356f09.js"><link rel="prefetch" href="/assets/js/55.79840f1c.js"><link rel="prefetch" href="/assets/js/56.343306c2.js"><link rel="prefetch" href="/assets/js/57.90f7511a.js"><link rel="prefetch" href="/assets/js/58.59457ff7.js"><link rel="prefetch" href="/assets/js/59.a05e2b0c.js"><link rel="prefetch" href="/assets/js/6.6aa986f5.js"><link rel="prefetch" href="/assets/js/60.7d6e698d.js"><link rel="prefetch" href="/assets/js/61.d1952570.js"><link rel="prefetch" href="/assets/js/62.a15b1cb5.js"><link rel="prefetch" href="/assets/js/63.69030ee5.js"><link rel="prefetch" href="/assets/js/64.a60b63a8.js"><link rel="prefetch" href="/assets/js/65.c1986cb9.js"><link rel="prefetch" href="/assets/js/66.e5747c76.js"><link rel="prefetch" href="/assets/js/67.c7de5e6a.js"><link rel="prefetch" href="/assets/js/68.96f4e3c6.js"><link rel="prefetch" href="/assets/js/69.db66370e.js"><link rel="prefetch" href="/assets/js/7.1fb8aaeb.js"><link rel="prefetch" href="/assets/js/70.8962d544.js"><link rel="prefetch" href="/assets/js/71.695bacdf.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.7bd035a8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.png" alt="流程引擎原理与实践" class="logo"> <span class="site-name can-hide">流程引擎原理与实践</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="目录" class="dropdown-title"><span class="title">目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="目录" class="mobile-dropdown-title"><span class="title">目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/1-引言.html" class="nav-link">
  1 引言
</a></li><li class="dropdown-item"><!----> <a href="/2-概念.html" class="nav-link">
  2 概念
</a></li><li class="dropdown-item"><!----> <a href="/3-流程建模和解析.html" class="nav-link">
  3 流程建模和解析
</a></li><li class="dropdown-item"><!----> <a href="/4-流程引擎的核心组件.html" class="nav-link">
  4 流程引擎的核心组件
</a></li><li class="dropdown-item"><!----> <a href="/5-事件驱动机制.html" class="nav-link">
  5 事件驱动机制
</a></li><li class="dropdown-item"><!----> <a href="/6-核心表结构与接口设计.html" class="nav-link">
  6 核心表结构与接口设计
</a></li><li class="dropdown-item"><!----> <a href="/7-权限系统设计.html" class="nav-link">
  7 权限系统设计
</a></li><li class="dropdown-item"><!----> <a href="/8-分布式Crontab任务调度.html" class="nav-link">
  8 分布式Crontab任务调度
</a></li><li class="dropdown-item"><!----> <a href="/9-流程分析.html" class="nav-link">
  9 流程分析
</a></li><li class="dropdown-item"><!----> <a href="/10-云原生工作流.html" class="nav-link">
  10 云原生工作流
</a></li><li class="dropdown-item"><!----> <a href="/11-多引擎分布式系统实现.html" class="nav-link">
  11 多引擎分布式系统实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="帮助" class="dropdown-title"><span class="title">帮助</span> <span class="arrow down"></span></button> <button type="button" aria-label="帮助" class="mobile-dropdown-title"><span class="title">帮助</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  关于
</a></li><li class="dropdown-item"><!----> <a href="/sponsor.html" class="nav-link">
  打赏赞助
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/guanchao/workflow-engine-book" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="目录" class="dropdown-title"><span class="title">目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="目录" class="mobile-dropdown-title"><span class="title">目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/1-引言.html" class="nav-link">
  1 引言
</a></li><li class="dropdown-item"><!----> <a href="/2-概念.html" class="nav-link">
  2 概念
</a></li><li class="dropdown-item"><!----> <a href="/3-流程建模和解析.html" class="nav-link">
  3 流程建模和解析
</a></li><li class="dropdown-item"><!----> <a href="/4-流程引擎的核心组件.html" class="nav-link">
  4 流程引擎的核心组件
</a></li><li class="dropdown-item"><!----> <a href="/5-事件驱动机制.html" class="nav-link">
  5 事件驱动机制
</a></li><li class="dropdown-item"><!----> <a href="/6-核心表结构与接口设计.html" class="nav-link">
  6 核心表结构与接口设计
</a></li><li class="dropdown-item"><!----> <a href="/7-权限系统设计.html" class="nav-link">
  7 权限系统设计
</a></li><li class="dropdown-item"><!----> <a href="/8-分布式Crontab任务调度.html" class="nav-link">
  8 分布式Crontab任务调度
</a></li><li class="dropdown-item"><!----> <a href="/9-流程分析.html" class="nav-link">
  9 流程分析
</a></li><li class="dropdown-item"><!----> <a href="/10-云原生工作流.html" class="nav-link">
  10 云原生工作流
</a></li><li class="dropdown-item"><!----> <a href="/11-多引擎分布式系统实现.html" class="nav-link">
  11 多引擎分布式系统实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="帮助" class="dropdown-title"><span class="title">帮助</span> <span class="arrow down"></span></button> <button type="button" aria-label="帮助" class="mobile-dropdown-title"><span class="title">帮助</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  关于
</a></li><li class="dropdown-item"><!----> <a href="/sponsor.html" class="nav-link">
  打赏赞助
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/guanchao/workflow-engine-book" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第一部份：流程引擎基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>第二部份：流程引擎实现</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>4 流程引擎的核心组件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/4.1-WFMC工作流参考模型.html" class="sidebar-link">4.1 WFMC工作流参考模型</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>4.2 任务调度机制</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/4.2.1-DAG调度算法原理与实践.html" class="sidebar-link">4.2.1 DAG调度算法原理与实践</a></li><li><a href="/4.2.2-开源Airflow DAG调度算法剖析.html" class="sidebar-link">4.2.2 开源Airflow DAG调度算法剖析</a></li><li><a href="/4.2.3-FSM调度算法原理与实践.html" class="sidebar-link">4.2.3 FSM调度算法原理与实践</a></li><li><a href="/4.2.4-开源OSWorkflow FSM调度算法剖析.html" class="sidebar-link">4.2.4 开源OSWorkflow FSM调度算法剖析</a></li><li><a href="/4.2.5-Petri网调度算法原理与实践.html" class="sidebar-link">4.2.5 Petri网调度算法原理与实践</a></li><li><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html" class="active sidebar-link">4.2.6 开源YAWL Petri网调度算法剖析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#yawl核心概念" class="sidebar-link">YAWL核心概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#基本元素" class="sidebar-link">基本元素</a></li><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#软件组成" class="sidebar-link">软件组成</a></li><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#xml流程定义" class="sidebar-link">XML流程定义</a></li><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#流程测试" class="sidebar-link">流程测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#yawl-petri网核心方法剖析" class="sidebar-link">YAWL Petri网核心方法剖析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#yengine-java类的startcase方法" class="sidebar-link">YEngine.java类的startCase方法</a></li><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#ynetrunner类的continueifpossible" class="sidebar-link">YNetRunner类的continueIfPossible</a></li><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#ytask类的t-enabled方法" class="sidebar-link">YTask类的t_enabled方法</a></li><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#ynetrunner类的firetasks方法" class="sidebar-link">YNetRunner类的fireTasks方法</a></li><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#ynetrunner类的firecompositetask方法" class="sidebar-link">YNetRunner类的fireCompositeTask方法</a></li><li class="sidebar-sub-header"><a href="/4.2.6-开源YAWL Petri网调度算法剖析.html#ytask内部条件状态流转" class="sidebar-link">YTask内部条件状态流转</a></li></ul></li></ul></li></ul></section></li><li><a href="/4.3-工作流模式-控制流模式.html" class="sidebar-link">4.3 工作流模式-控制流模式</a></li><li><a href="/4.4-资源调度机制-资源模式.html" class="sidebar-link">4.4 资源调度机制-资源模式</a></li><li><a href="/4.5-数据管理机制-数据模式.html" class="sidebar-link">4.5 数据管理机制-数据模式</a></li><li><a href="/4.6-异常处理机制-异常处理模式.html" class="sidebar-link">4.6 异常处理机制-异常处理模式</a></li><li><a href="/4.7-引擎执行模式.html" class="sidebar-link">4.7 引擎执行模式</a></li></ul></section></li><li><a href="/5-事件驱动机制.html" class="sidebar-link">5 事件驱动机制</a></li><li><a href="/6-核心表结构与接口设计.html" class="sidebar-link">6 核心表结构与接口设计</a></li><li><a href="/7-权限系统设计.html" class="sidebar-link">7 权限系统设计</a></li><li><a href="/8-分布式Crontab任务调度.html" class="sidebar-link">8 分布式Crontab任务调度</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第三部份：流程引擎进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>前面我们介绍了Petri网的原理，这篇文章我们介绍基于Petri网原理实现的开源项目来加深对Petri网的理解。目前网上基于YAWL的开源和商业化产品非常少，YAWL是其中一个开源的项目，虽然时间比较久远，但是他是比较严格遵循Petri网原理实现的项目，有很多思想和原理是可以学习和参考的。</p> <h2 id="yawl核心概念"><a href="#yawl核心概念" class="header-anchor">#</a> YAWL核心概念</h2> <h3 id="基本元素"><a href="#基本元素" class="header-anchor">#</a> 基本元素</h3> <p>YAWL（Yet Another Workflow Language）是一种基于Petri网的工作流引擎，它提供了一种用于描述和执行业务流程的形式化方法。YAWL工作流引擎是一个开源项目，由澳大利亚昆士兰科技大学和荷兰埃因霍温科技大学的研究人员共同开发。它的目标是为组织提供一个灵活、可扩展和易于集成的工作流解决方案。</p> <p>YAWL工作流引擎的核心特点包括：</p> <ol><li>强大的建模能力：YAWL工作流引擎提供了丰富的建模元素，如任务、条件、资源、数据和事件，以支持各种业务场景的建模需求。同时，它还支持复杂的控制流和数据流模式，使得用户能够轻松地描述多样化的业务过程。</li> <li>灵活的资源管理：YAWL工作流引擎提供了一种基于角色和规则的资源管理模式，使得用户可以灵活地分配任务给不同的参与者。此外，它还支持资源过滤、优先级分配和任务委派等高级功能，以满足不同组织的需求。</li> <li>可扩展的架构：YAWL工作流引擎采用了模块化的设计，用户可以根据需要选择和扩展不同的功能模块。同时，它还提供了一套完整的API，方便用户与其他系统进行集成。</li> <li>易于使用的工具支持：YAWL工作流引擎提供了一套图形化的建模和执行工具，使得用户可以直观地设计、验证和执行业务流程。此外，它还提供了丰富的文档和示例，帮助用户快速上手。</li> <li>开源和社区支持：YAWL工作流引擎是一个开源项目，用户可以免费使用和修改其源代码。同时，它还拥有一个活跃的社区，用户可以在社区中获取帮助和分享经验。</li></ol> <p>下面是YAWL流程定义中支持的几种Condition类和Task类基本元素。<strong>YAWL中的Condition类元素对应Petri网的库所Place，Task类元素对应Petri网的变迁Transition。</strong></p> <img src="/assets/img/4.2.6-YAWL-symbology.9a5670f1.png"> <ol><li>Condition：条件是YAWL流程中的一个基本元素，代表了流程中的一个状态。条件可以是开始状态、结束状态或者中间的任何一个状态。</li> <li>InputCondition：输入条件是流程的开始状态，只有满足了输入条件，流程才能开始。</li> <li>OutputCondition：输出条件是流程的结束状态，只有满足了输出条件，流程才能结束。</li> <li>AtomicTask：原子任务是流程中的一个基本执行单元，它不能被进一步分解。</li> <li>CompositeTask：复合任务是由两个或者更多的原子任务组成的，它可以被分解为更小的任务进行执行。</li> <li>Multiple Instance of an Atomic Task：原子任务的多实例表示一个原子任务可以有多个实例同时执行。</li> <li>Multiple Instance of a Composite Task：复合任务的多实例表示一个复合任务可以有多个实例同时执行。</li> <li>AND-split task：AND-split任务表示一个任务可以同时分裂为多个并行的任务。</li> <li>AND-join task：AND-join任务表示多个并行的任务必须都完成，才能继续执行下一个任务。</li> <li>OR-split task：OR-split任务表示一个任务可以分裂为多个并行的任务，但只需要其中的任何一个任务完成，就可以继续执行下一个任务。</li> <li>OR-join task：OR-join任务表示多个并行的任务只需要其中的任何一个任务完成，就可以继续执行下一个任务。</li> <li>XOR-split task：XOR-split任务表示一个任务可以分裂为多个并行的任务，但只能选择其中的一个任务进行执行。</li> <li>XOR-join task：XOR-join任务表示多个并行的任务只能选择其中的一个任务完成，才能继续执行下一个任务。</li> <li>Cancellation Region：取消区域是指在某个任务被执行时，可以取消该任务所在区域内的所有其他任务。这是YAWL中处理异常和撤销操作的一种机制。</li></ol> <h3 id="软件组成"><a href="#软件组成" class="header-anchor">#</a> 软件组成</h3> <p>安装完YAWL启动成功后，首先会看到下面的控制面板：</p> <img src="/assets/img/4.2.6 启动yawl-启动控制面板.778ae5b8.png" alt="image-20240319121807812" style="zoom:50%;"> <p>点击第四个图标：<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABcCAYAAAD50zLWAAABWmlDQ1BJQ0MgUHJvZmlsZQAAKJFtkM8rw3EYx1/fzY+FmnB02EWmRrMpHP0o1A5ryI9SvvtuNtrm47tJ5KacnfwFcnUzFzV35aCQnOWK2gV9Pd8N2/DU0/P6vHt/np7e4HDpSqXqgHQmZ0YmRj3zC4uexiectOPCT5duZNVIOBwSC9+ztoo3aPa87rV3PY4XNHf6/m5/r/uq4eU88NdfU02xeNaQ+S7dZygzB5pPOLyVUzbvCneYcpTwgc2JMh/ZHC3zWckzExkTvhRuNZJ6TPhB2Bet0hNVnE5tGl832Ne3xDOz0zLbpDsJM0kIDwEGGWKUfsnnf/9AyT/GOoptTFZJkCQnf0dEUaSIC0+RwaAPX2mnX3rAzvl3fhVtwwvDz+BYq2hLO3B6Am5V0bxBeS/DRUTppv6Tqlasy64Ey9lrzXmoP7Ss1zlo7IGPW8t6y1vWxzE476FQ/ASEzmKPHgfNOgAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAFCgAwAEAAAAAQAAAFwAAAAAnjpISAAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABqdJREFUeAHtndlPFE0UxQWRRcGFxRWFCM8YNsEt/hf+rcZXZVEEFRPhRaMsCgEhGDdw4bPP568zdKprursGBbw89Jm+det21Zkzt7ZOqFpZWdk+ZH+FGaguXNMqigEjMFAIRqARGMhAYHVToBEYyEBgdVNgIIE1L1++DAzxb1c3BQZ+/zXUb29v56NhBgYWFhbkZQrMQJbPJVZgdbVx6SMqrcxYS2Mmo90IzEhUmlv8E66qqkrzMbuHAVOgh5wsRUZgFpY8Pkagh5wsRZly4Pb29qEoR0aY9ncQy7OMCzGBacREdgKBab4HvdzVb/sJu1jJYTMCc5DlcjUCXazksGXKgTni/XHX9+/f65lPnz4Vzs/PC1taWoSDg4PCM2fOCMvlaTnluJgCc5Dlct23Cvz8+bP68/z5c+Hs7OyO/n369En3W1tbwmvXrgnPnTsnrJQSYwJ9AffDPFCseC5R//LOY32c8KiYQAwuJBDo8olsu1n+8+dPPXZtbU349etXYVtbm/DYsWNClKebX5elpSV9HBsbE/qUWK79xCxFy4GlbBT4nEmBBeJWvArKu3fvnmKjluHhYd0PDAwIJycnhR8/fhRyeffunT6ixOvXr+uenIhfXjQF5mUs4b9nFUjCZ57HqEv7sT98+FCmoaEhYX9/vzBNieRE5o2mQBj9S7jnFIjy5ubmRAlKYSWBwqamplS+uroqfPTokfDq1atC/NKUuLGxIb/QS0wgSdkVcC/MA6NjV6YyrjaG2qL+8+URy8cJPjGBGFxIINDlE9kqUf7mzRuFZ7RcX1/X/eHDh4V9fX1CzrFR2K93vWVPKpHReWJiQuXk0rNnz+q+tM2ln1WY4WKjcAaSfC6ZFOgLUKmyV69eKRSjKspjlOzt7VX5ixcvhN++fRNif/Lkie5RInFYeTBKLy8vy6+np0cYejEFBjL41xWYVB4rjvPnz6trjKqLi4u6Z1Sm34y2KG10dFRFjM7k0lu3bsne2dkpPHr0qDD0YgoMZPCvKTCpPFYWKI+cxQ7z9PS0urq5uSk8fvy48NSpU0JyJaP048ePZWdqUl9fr3t2bXRTgUtMINMCV8xo/lVuHhZa7npuHls0zfnx40dqlSLt83HCg2ICMbiQQKDLJ7JlKX/9+rWqM0qSq3hDll0S/FAe+39NTU2qf+PGDWFDQ4Pw7t27wtOnTwtv374tbGxsFKJUXxt9ZQriuFgOdJCSx5RJgXkCpvmiqJGREbmEKg8lMsqSK79//6743d3dQk7n0toVajcFBjK46wpkbZtU3sWLF9V0Rlv8kjmPHEbOO3HihOoRj7flW1tbZWcU5j6Qn7LVTYFlKfI7VFyBzLvISQ8ePFALyHkojxUGCnr27Jn80kbbcspDoaw0/N2uXGlMoG8Ir8Q8MLTJ0VYTX06RWFH/fPuJrnIfJ7QhJhCDCwkEunxo3Nu3b1V8//59ISuMS5cu6Z79OU7JWNuiPFYYKArloWTWxOQ45o2XL192NWuHzdf+yLFc+Y5gv28sB7pYyWHLpMAs8djpZYcY5ZHz2DXhVIwzDZSH0lAe8zyUh7KZ1+GXRXlZ2l/UxxRYlLnf9SqmwC9fvigkuY2155UrV3bYkznv5MmTKieXMe9jX494zc3N8tsrylNjfl1MgTBREIMVyBYSZxHs15GbeHuKc15OvtKUx9qWnIeS95ry4NsUCBMFMViB7H6womB/jnNXRldG4SNHjqipzOPIeWnKu3nzpvw7OjoKdnF3q5kCA/kNViDnsyiQswfONmgfSuMcl7Xx+Pi4XFhhMM9DeaxgiqwSePZuoikwkN1YgYyOrnjRIj5tMc/KgjdCWcuiTM55I4VFcVAabwjwlhTzPM5vOSNBeWnPp727Ue7jhOfGBGJwIYFAl0/Shi8YlUefSwlJ1sHHhaU2V70/Ue56biYCXRWxMb9jq+nDhw8qSr7LzFqZeWJdXZ382L9jJ/nChQuy8zYWz9mraDkw8JupuAJpD29X8SZAV1eXishtrFCYN4L7RXn00xQIEwUxWIEojOczbwNZkdTW1sqlpub/R+43pdG/JJoCk4zkvA9W4J07d3I+8mC5mwIDv08jMJDA+CdcumJIxvQt5fCN6jOZxlaK+7Hcxwl9iwnE4EICgS6fyHbQy139tp+wi5UcNiMwB1kuVyPQxUoOmxGYgyyXqxHoYiWHzQjMQZbL1Qh0sZLDFs8Dy83hcsT8p1xNgYFfd6zAmZmZwFD/ZnVTYOD3XmX/Vy6MQVNgGH/2gmUgf0ZgKIH/AeFkka0fmjM0AAAAAElFTkSuQmCC" alt="image-20240319122015478" style="zoom:50%;">进入流程编辑器。</p> <p>在这个编辑器可以通过可视化的方式设计YAWL的流程定义，包括任务顺序、变量引用、资源分配等。</p> <img src="/assets/img/4.2.6 yawl进入流程编辑器.9d1f6476.png" alt="image-20240319121918390" style="zoom:50%;"> <p>点击第三个图标：<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABWCAYAAABPaoF5AAAAAXNSR0IArs4c6QAAAHhlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAFqgAwAEAAAAAQAAAFYAAAAAXgHeFwAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABVtJREFUeAHtXb1rHFcQ3zvrAwdcBiR1KtIZXF2VwmAX7hKwwVhgCJI7tzaqVAoMBv8NwpWU0m5UBSSC00i9G9VSJwjEOLFOd/a+uzlm3u6bnbdvdn13mSv85r35/u1odnZ1tjuXl5fDzD6NI9Bt3IM5cAgs5H8eHR25jf1RD4H19fVKRavoSoh0BFxFg6lerwekrQIETk5OiNTKygrZ4w0ButPpYJ7RiggY0IpgdrvhThzmKAZgprLMKrqlKjCgFYHm7nHWOhSB5kwZ0Bw6ijwDWhFMzhTp0dx4MhgMspyfr6HPPPI5THwcuB5NgPYV8R4cwop5mJ53Ps41hrbWEYNWgqwBnQBejKoBHYNWgizp0VwzHw6HWc7P19BnHvkcJiEcys4J0GUCcAYOYYVzf513vp+vdC8GWmJwZ2dHIjY1Mru7u63FQoDmqlHSOlqLuiFHef5+a+Qw8cPgZAnQviLegxFYMW9zcxNvZ4be2tpyse7t7U1iLstvwkwgCNCcE6voBJS/qRKg00xl2dramjOxurqaaqpR/YuLC2f//Py8UT/YuBhoqHZYsZFZp3FOmNbMSwx0jFOomBideZe1J8OWrrBqRU97b/Yx/W49mutPNnX4l6m45/ATVzQYgRW7gWkDeD//+htmTx394d1bF5Mfd34IOWgHTYDmnFhFp0FPgK5rCnrdL8+2nYneTz/WNdWK3g+PR0+Er7aft+IvdyIGGqod1tYibMERzgnTmq7FQEucfv7vWiJWkPlyNdJbWrzheG9evynIaBy82H7hzPzzb704U2KwOToFvQhd1YrOsvBXEbiYoJI5GU3e9/hyMgGa6082dVRfau6rFgRozhRcBFjLZAfX5b9PvH/3bpn45OyP4+MJjYlHDx+67Z07t/FxbfrvT5+crv99e5wTpms7KlEkQHNOrKJL0Is4IkBH6JWLdnW733W/memA+UV+eV4Kp2KgodphVfA9NSZwTpjWDFAMtMSp3/tAJ9SDgR9al5dUwwu5aeXc5uhWYI54BJfFM5o6Pn/pO/GbNSsSnuDAJ0wLsE9dh8N6836KX/KzyfUnmzqqYebwI0BzpsAIrGWyg+vyqQMq3NepW/G+nej9gM77OCdMR9tlFKxHM+BossQVHeP01vLo+vXHhRNbuU2/vRuGxqOYJCNlraIjAasrTiqa608xN8P+kF6/fuAJbzB+RFtaJGEUcrmxMHpPnUFvFT6BXo2nn64n36EteuIvzz/PE384TLBcFc1niLTBIayINfMkzgnTmomJgZY4vQr81bgH9++x6qEnx6be3mUZrVo2OCUm/RlXMmpmigioVnT5FF10Kj1p6u1d4LW5NKxaclbRtWCLV1Kt6MXAv8By/Gf5b1D6Fa8cmnp7twBTTDxetTWsomtDF6dIKpobbSRz9Mfj3533B72XJIqqyiXC3zZNv7376/1b36Xb5/mnzNEcfgToUu/jQzACKyc7azycE6Y18xADLXF6enrqxJ4+eSIR/1/JWI9u6XKrVPT+/r4Ld2Njo6WwddxA3DrWeCsEaK4/SW6GvKvp5+b5p9wMuQwJ0JyghHdwcFAIFOuVJTJNfByLNi0GGqod1lAg884P5V11bjfDKoSU+Aa0EpBVZgzoKoSU+KRHc/1VMnXk+v5dG8c5i3wOE5xbTnOyBGhfEe/BCKyYh+l55+NcY2hrHTFoJcga0Angxaga0DFoJcga0AngxaiSm2HVjSzGsMlSBKyiKR6N7QzoxqClhq11UDySdlzrtYpOglauTCr68PBQrmmSBQTOzs4KZ3BgFQ1INLx27H/obBjhsXmr6HZwzgxoA7olBFpy8xW2gV3qOs0lfwAAAABJRU5ErkJggg==" alt="image-20240909230821367" style="zoom:50%;">进入管理系统（默认账号：admin，密码：YAWL)。</p> <p>导入上一步设计的流程定义XML文件后，就可以在这里进行任务的分发以及任务的处理。</p> <img src="/assets/img/4.2.6-image-20240319122651842.0523b7da.png" alt="image-20240319122651842" style="zoom:50%;"> <h3 id="xml流程定义"><a href="#xml流程定义" class="header-anchor">#</a> XML流程定义</h3> <p>我们直接通过一个官方具体的流程例子来了解YAWL的XML流程定义。下面这个描述了一个名为&quot;Document Handling&quot;的业务流程。</p> <img src="/assets/img/4.2.6-yawl-demo.2172a8c2.png" alt="image-20240905093037977" style="zoom:50%;"> <p>这个业务流程包含两个任务：Upload和Download。Upload任务的完成将触发Download任务的开始。每个任务都有自己的输入和输出参数，以及任务的执行条件和分支选择。</p> <p>以下是一些关键元素的解释：</p> <ol><li><p><code>&lt;metaData&gt;</code>：包含了业务流程的元数据，如标题、创建者、描述、版本等。例如，</p> <p><code>&lt;title&gt;</code>定义了流程的标题为&quot;Document Handling&quot;</p> <p><code>&lt;creator&gt;</code>定义了流程的创建者为&quot;Andreas V. Hense&quot;</p> <p><code>&lt;description&gt;</code>定义了流程的描述信息</p> <p><code>&lt;version&gt;</code>定义了流程的版本为0.6。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>metaData</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document Handling<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>creator</span><span class="token punctuation">&gt;</span></span>Andreas V. Hense<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>creator</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>creator</span><span class="token punctuation">&gt;</span></span>September 2014<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>creator</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>A simple workflow that demonstrates the document handling feature of YAWL.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistent</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>persistent</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>identifier</span><span class="token punctuation">&gt;</span></span>UID_af746526-a31f-490d-a43b-8bfa8c522a5d<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>identifier</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>metaData</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><code>&lt;decomposition&gt;</code>：定义了业务流程的主要组成部分，即任务。每个Decomposition元素都包含了一系列的任务定义。</p> <p>在这个例子中，有一个名为&quot;Net&quot;的分解，它是根网络，包含了所有的任务和流程控制元素。&quot;Net&quot;分解中定义了一个名为&quot;document&quot;的本地变量，类型为&quot;YDocumentType&quot;。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decomposition</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Net<span class="token punctuation">&quot;</span></span> <span class="token attr-name">isRootNet</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>NetFactsType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localVariable</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>index</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>index</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>YDocumentType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>namespace</span><span class="token punctuation">&gt;</span></span>http://www.w3.org/2001/XMLSchema<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>namespace</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>initialValue</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localVariable</span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decomposition</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><img src="/assets/img/4.2.6-yawl-demo-step3.5a2eac51.png" alt="image-20240905093357980" style="zoom:50%;"> <img src="/assets/img/4.2.6-yawl-demo-step4.cc6d1900.png" alt="image-20240905093428843" style="zoom:50%;"></li> <li><p><code>&lt;task&gt;</code>：定义了一个具体的任务，包括任务的名称、描述、输入和输出参数、执行条件等。</p> <p>在这个例子中，有两个任务：Upload和Download。每个任务都有自己的名称，例如&quot;Upload&quot;任务的名称就是&quot;Upload&quot;。每个任务都有自己的执行条件和分支选择，例如&quot;Upload&quot;任务的连接条件和分支选择分别是&quot;xor&quot;和&quot;and&quot;。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>join</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xor<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>split</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>and<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decomposesTo</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><code>&lt;flowsInto&gt;</code>：定义了任务的执行顺序和分支选择。</p> <p>例如，&quot;InputCondition&quot;任务执行完后将流转到&quot;Upload&quot;任务，&quot;Upload&quot;任务执行完后将流转到&quot;Download&quot;任务。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>inputCondition</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>InputCondition<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flowsInto</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nextElementRef</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flowsInto</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>inputCondition</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><code>&lt;mapping&gt;</code>：定义了任务的输入和输出数据的映射。</p> <p>例如，&quot;Upload&quot;任务完成后，它的输出数据将映射到&quot;document&quot;变量。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>completedMappings</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expression</span> <span class="token attr-name">query</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token entity named-entity" title="&lt;">&amp;lt;</span>document<span class="token entity named-entity" title="&gt;">&amp;gt;</span>{/Upload/document/*}<span class="token entity named-entity" title="&lt;">&amp;lt;</span>/document<span class="token entity named-entity" title="&gt;">&amp;gt;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapsTo</span><span class="token punctuation">&gt;</span></span>document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapsTo</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapping</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>completedMappings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><img src="/assets/img/4.2.6-yawl-demo-mapping.05a94dbe.png" alt="image-20240905093609091" style="zoom:67%;"></li> <li><p><code>&lt;resourcing&gt;</code>：定义了任务的资源分配策略。</p> <p>例如，&quot;Upload&quot;任务的资源分配策略是由用户触发，而&quot;Download&quot;任务的资源分配策略是由系统触发。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resourcing</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>offer</span> <span class="token attr-name">initiator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>allocate</span> <span class="token attr-name">initiator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>start</span> <span class="token attr-name">initiator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resourcing</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><code>&lt;decomposesTo&gt;</code>：指定了任务的具体实现。</p> <p>例如，&quot;Upload&quot;任务的具体实现是&quot;Upload&quot;分解。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decomposesTo</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
....
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decomposition</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>WebServiceGatewayFactsType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputParam</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>index</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>index</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>YDocumentType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>namespace</span><span class="token punctuation">&gt;</span></span>http://www.w3.org/2001/XMLSchema<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>namespace</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultValue</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputParam</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>externalInteraction</span><span class="token punctuation">&gt;</span></span>manual<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>externalInteraction</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decomposition</span><span class="token punctuation">&gt;</span></span>

</code></pre></div></li> <li><p><code>&lt;layout&gt;</code>：定义了业务流程的布局信息，包括每个任务和流程控制元素的位置和大小。</p> <p>例如，&quot;InputCondition&quot;的位置是(x=36, y=44)，大小是(w=32, h=32)。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>specification</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>document<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>net</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Net<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      ...
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vertex</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>InputCondition<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attributes</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bounds</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>36<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>44<span class="token punctuation">&quot;</span></span> <span class="token attr-name">w</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">h</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>32<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attributes</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vertex</span><span class="token punctuation">&gt;</span></span>
      ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>net</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>specification</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol> <blockquote><p>document.xml</p></blockquote> <p>下面是完整的定义文件：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>specificationSet</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.yawlfoundation.org/yawlschema<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.yawlfoundation.org/yawlschema http://www.yawlfoundation.org/yawlschema/YAWL_Schema3.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>specification</span> <span class="token attr-name">uri</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>document<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>documentation</span><span class="token punctuation">&gt;</span></span>No description provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>documentation</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>metaData</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document Handling<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>creator</span><span class="token punctuation">&gt;</span></span>Andreas V. Hense<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>creator</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>creator</span><span class="token punctuation">&gt;</span></span>September 2014<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>creator</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>A simple workflow that demonstrates the document handling feature of YAWL.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistent</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>persistent</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>identifier</span><span class="token punctuation">&gt;</span></span>UID_af746526-a31f-490d-a43b-8bfa8c522a5d<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>identifier</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>metaData</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>schema</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decomposition</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Net<span class="token punctuation">&quot;</span></span> <span class="token attr-name">isRootNet</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>NetFactsType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localVariable</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>index</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>index</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>YDocumentType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>namespace</span><span class="token punctuation">&gt;</span></span>http://www.w3.org/2001/XMLSchema<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>namespace</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>initialValue</span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localVariable</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>processControlElements</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>inputCondition</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>InputCondition<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flowsInto</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nextElementRef</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flowsInto</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>inputCondition</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flowsInto</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nextElementRef</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Download<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flowsInto</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>join</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xor<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>split</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>and<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>completedMappings</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapping</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expression</span> <span class="token attr-name">query</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token entity named-entity" title="&lt;">&amp;lt;</span>document<span class="token entity named-entity" title="&gt;">&amp;gt;</span>{/Upload/document/*}<span class="token entity named-entity" title="&lt;">&amp;lt;</span>/document<span class="token entity named-entity" title="&gt;">&amp;gt;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapsTo</span><span class="token punctuation">&gt;</span></span>document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapsTo</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapping</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>completedMappings</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resourcing</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>offer</span> <span class="token attr-name">initiator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>allocate</span> <span class="token attr-name">initiator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>start</span> <span class="token attr-name">initiator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resourcing</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decomposesTo</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>task</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Download<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Download<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flowsInto</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nextElementRef</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>OutputCondition<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flowsInto</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>join</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xor<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>split</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>and<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>startingMappings</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapping</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>expression</span> <span class="token attr-name">query</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token entity named-entity" title="&lt;">&amp;lt;</span>document<span class="token entity named-entity" title="&gt;">&amp;gt;</span>{/Net/document/*}<span class="token entity named-entity" title="&lt;">&amp;lt;</span>/document<span class="token entity named-entity" title="&gt;">&amp;gt;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapsTo</span><span class="token punctuation">&gt;</span></span>document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapsTo</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapping</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>startingMappings</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resourcing</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>offer</span> <span class="token attr-name">initiator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>system<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>distributionSet</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>initialSet</span> <span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>distributionSet</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>familiarParticipant</span> <span class="token attr-name">taskID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>offer</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>allocate</span> <span class="token attr-name">initiator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>system<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>allocator</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>RandomChoice<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>allocator</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>allocate</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>start</span> <span class="token attr-name">initiator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>system<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resourcing</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decomposesTo</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Download<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>task</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputCondition</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>OutputCondition<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>processControlElements</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decomposition</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decomposition</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Download<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>WebServiceGatewayFactsType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>inputParam</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>index</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>index</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>YDocumentType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>namespace</span><span class="token punctuation">&gt;</span></span>http://www.w3.org/2001/XMLSchema<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>namespace</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>inputParam</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>externalInteraction</span><span class="token punctuation">&gt;</span></span>manual<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>externalInteraction</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decomposition</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>decomposition</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>WebServiceGatewayFactsType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputParam</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>index</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>index</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>YDocumentType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>namespace</span><span class="token punctuation">&gt;</span></span>http://www.w3.org/2001/XMLSchema<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>namespace</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultValue</span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputParam</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>externalInteraction</span><span class="token punctuation">&gt;</span></span>manual<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>externalInteraction</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>decomposition</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>specification</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>locale</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span> <span class="token attr-name">country</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>US<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>specification</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>document<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>size</span> <span class="token attr-name">w</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>62<span class="token punctuation">&quot;</span></span> <span class="token attr-name">h</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>26<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>net</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Net<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bounds</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">w</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>691<span class="token punctuation">&quot;</span></span> <span class="token attr-name">h</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>933<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>frame</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">w</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>694<span class="token punctuation">&quot;</span></span> <span class="token attr-name">h</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>936<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>viewport</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">w</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>694<span class="token punctuation">&quot;</span></span> <span class="token attr-name">h</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>936<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vertex</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>OutputCondition<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attributes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bounds</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>424<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>44<span class="token punctuation">&quot;</span></span> <span class="token attr-name">w</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">h</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>32<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attributes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vertex</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vertex</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>InputCondition<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attributes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bounds</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>36<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>44<span class="token punctuation">&quot;</span></span> <span class="token attr-name">w</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">h</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>32<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attributes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vertex</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>container</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Download<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vertex</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attributes</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bounds</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>284<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>44<span class="token punctuation">&quot;</span></span> <span class="token attr-name">w</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">h</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>32<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attributes</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vertex</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attributes</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bounds</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>252<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>76<span class="token punctuation">&quot;</span></span> <span class="token attr-name">w</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>96<span class="token punctuation">&quot;</span></span> <span class="token attr-name">h</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>18<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attributes</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>container</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>container</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vertex</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attributes</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bounds</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>140<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>44<span class="token punctuation">&quot;</span></span> <span class="token attr-name">w</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">h</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>32<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attributes</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vertex</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attributes</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bounds</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>108<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>76<span class="token punctuation">&quot;</span></span> <span class="token attr-name">w</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>96<span class="token punctuation">&quot;</span></span> <span class="token attr-name">h</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>18<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attributes</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>container</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flow</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>InputCondition<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ports</span> <span class="token attr-name">in</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>13<span class="token punctuation">&quot;</span></span> <span class="token attr-name">out</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>12<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attributes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lineStyle</span><span class="token punctuation">&gt;</span></span>11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lineStyle</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>points</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>67<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>55.5<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>212<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>55.5<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>points</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attributes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flow</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flow</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Download<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ports</span> <span class="token attr-name">in</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>13<span class="token punctuation">&quot;</span></span> <span class="token attr-name">out</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>12<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attributes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lineStyle</span><span class="token punctuation">&gt;</span></span>11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lineStyle</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>points</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>243<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>55.5<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>404<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>55.5<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>points</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attributes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flow</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flow</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Download<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>OutputCondition<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ports</span> <span class="token attr-name">in</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>13<span class="token punctuation">&quot;</span></span> <span class="token attr-name">out</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>12<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attributes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lineStyle</span><span class="token punctuation">&gt;</span></span>11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lineStyle</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>points</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>435<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>55.5<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>620<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>55.5<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>points</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attributes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flow</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>net</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>specification</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>specificationSet</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="流程测试"><a href="#流程测试" class="header-anchor">#</a> 流程测试</h3> <p>下面我们将前面的流程定义文件导入到YAWL管理系统：</p> <img src="/assets/img/4.2.6 yawl导入xml.92954221.png" alt="image-20240319130726833" style="zoom:50%;"> <p>创建一个参与者，后续任务会分配给这个参与者：</p> <img src="/assets/img/4.2.6 yawl创建参与者.8061f89c.png" alt="image-20240319130858498" style="zoom:50%;"> <p>启动流程：</p> <img src="/assets/img/4.1.6 yawl启动流程.03d81b47.png" alt="image-20240319130956180" style="zoom:50%;"> <p>分发任务，任务分发后有原来的Unoffered状态变为Offered状态：</p> <img src="/assets/img/4.2.6 yawl任务分发.ca128fb9.png" alt="image-20240319131129870" style="zoom:50%;"> <p>切换到前面创建的test账号处理分发的任务：</p> <p>接收并启动任务，任务状态从Offered转换到Started，</p> <img src="/assets/img/4.2.6 yawl接收并启动任务.1e6d9afe.png" alt="image-20240319131349675" style="zoom:50%;"> <p>完成任务后，在我的工作列表页面就会清空：</p> <img src="/assets/img/4.2.6 yawl完成任务.e4ba1288.png" alt="image-20240319131453605" style="zoom:50%;"> <p>Upload任务完成后就会触发下一个任务实例创建启动，同样的按照前面的操作完成即可。</p> <img src="/assets/img/4.2.6 yawl新任务启动.e28be128.png" alt="image-20240319131553169" style="zoom:50%;"> <p>至此，我们完整定义测试了YAWL的流程。下面我们具体展开其PetriNet算法核心的方法实现。</p> <h2 id="yawl-petri网核心方法剖析"><a href="#yawl-petri网核心方法剖析" class="header-anchor">#</a> YAWL Petri网核心方法剖析</h2> <p>YAWL核心的调度算法在YnetRunner类的continueIfPossible方法里，其中调用的t_enabled方法用于判断任务是否可以被激活，是整个核心的判断算法，该方法正是基于PetriNet的令牌机制实现的。</p> <p>注意：这里YAWL 所支持的两种类型节点：Condtion 和 Task。其中Condition对应PetriNet 中所 place 库所，Task对应PetriNet 中的 Transition变迁，在结合PetriNet算法分析源码时需要注意。</p> <h3 id="yengine-java类的startcase方法"><a href="#yengine-java类的startcase方法" class="header-anchor">#</a> YEngine.java类的startCase方法</h3> <p>下面是我们去启用一个流程时调用的一个方法。</p> <p>该方法的主要功能是启动一个新的工作流实例。以下是方法的主要步骤：</p> <ol><li>确保要启动的工作流规范已加载并为最新版本，否则抛出 YStateException 异常。</li> <li>检查并格式化工作流实例的输入参数。</li> <li>创建一个 YNetRunner 对象，用于执行工作流实例。</li> <li>将 YNetRunner 对象添加到 _netRunnerRepository 中。</li> <li>记录工作流实例已启动的日志。</li> <li>如果不是在恢复过程中，并且有持久化管理器，将 YNetRunner 对象持久化。</li> <li>使用持久化管理器继续执行工作流实例，调用<code>runner.continueIfPossible(_pmgr)</code>方法。</li> <li>使用持久化管理器启动工作流实例，调用<code>runner.start(_pmgr)</code>方法。</li> <li>获取工作流实例的标识符。</li> <li>如果工作流实例中有活动任务，将其添加到 _runningCaseIDToSpecMap 中。</li> <li>如果存在 _interfaceBClient，通知独立 GUI 添加新的工作流实例。</li> <li>返回工作流实例的标识符。</li></ol> <p>路径：yawl/src/org/yawlfoundation/yawl/engine /YEngine.java</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">YIdentifier</span> <span class="token function">startCase</span><span class="token punctuation">(</span><span class="token class-name">YSpecificationID</span> specID<span class="token punctuation">,</span> <span class="token class-name">String</span> caseParams<span class="token punctuation">,</span>
                                <span class="token class-name">URI</span> completionObserver<span class="token punctuation">,</span> <span class="token class-name">String</span> caseID<span class="token punctuation">,</span>
                                <span class="token class-name">YLogDataItemList</span> logData<span class="token punctuation">,</span> <span class="token class-name">String</span> serviceRef<span class="token punctuation">,</span> <span class="token keyword">boolean</span> delayed<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">YStateException</span><span class="token punctuation">,</span> <span class="token class-name">YDataStateException</span><span class="token punctuation">,</span> <span class="token class-name">YQueryException</span><span class="token punctuation">,</span> <span class="token class-name">YPersistenceException</span> <span class="token punctuation">{</span>

    <span class="token comment">// check spec is loaded and is latest version (YStateException if not)</span>
    <span class="token class-name">YSpecification</span> specification <span class="token operator">=</span> _specifications<span class="token punctuation">.</span><span class="token function">getSpecificationForCaseStart</span><span class="token punctuation">(</span>specID<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// check &amp; format case data params (if any)</span>
    <span class="token class-name">Element</span> data <span class="token operator">=</span> <span class="token function">formatCaseParams</span><span class="token punctuation">(</span>caseParams<span class="token punctuation">,</span> specification<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">YNetRunner</span> runner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YNetRunner</span><span class="token punctuation">(</span>_pmgr<span class="token punctuation">,</span> specification<span class="token punctuation">.</span><span class="token function">getRootNet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> caseID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _netRunnerRepository<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>runner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">logCaseStarted</span><span class="token punctuation">(</span>specID<span class="token punctuation">,</span> runner<span class="token punctuation">,</span> completionObserver<span class="token punctuation">,</span> caseParams<span class="token punctuation">,</span> logData<span class="token punctuation">,</span>
            serviceRef<span class="token punctuation">,</span> delayed<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// persist it</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span> _restoring<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>_pmgr <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _pmgr<span class="token punctuation">.</span><span class="token function">storeObject</span><span class="token punctuation">(</span>runner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    runner<span class="token punctuation">.</span><span class="token function">continueIfPossible</span><span class="token punctuation">(</span>_pmgr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    runner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>_pmgr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">YIdentifier</span> runnerCaseID <span class="token operator">=</span> runner<span class="token punctuation">.</span><span class="token function">getCaseID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// special case: if spec contains exactly one task, and its empty,</span>
    <span class="token comment">// the case (and runner) has already completed, so don't update map</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>runner<span class="token punctuation">.</span><span class="token function">hasActiveTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _runningCaseIDToSpecMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>runnerCaseID<span class="token punctuation">,</span> specification<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// announce the new case to the standalone gui (if any)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_interfaceBClient <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Asking client to add case {}&quot;</span><span class="token punctuation">,</span> runnerCaseID<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _interfaceBClient<span class="token punctuation">.</span><span class="token function">addCase</span><span class="token punctuation">(</span>specID<span class="token punctuation">,</span> runnerCaseID<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> runnerCaseID<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ynetrunner类的continueifpossible"><a href="#ynetrunner类的continueifpossible" class="header-anchor">#</a> YNetRunner类的continueIfPossible</h3> <p><code>continueIfPossible</code>方法主要用来控制工作流的执行流程。下面是函数具体的执行步骤：</p> <ol><li><p>首先，检查是否处于暂停状态。如果是，则记录一条调试信息，表示由于案例当前处于暂停/挂起状态而中止运行器继续，并返回true。</p></li> <li><p>如果网络已经完成，则不再继续，返回false。</p></li> <li><p>创建一个YEnabledTransitionSet类型的变量enabledTransitions，用于存储启用任务的运行集。</p></li> <li><p>遍历_netTasks中的所有任务（YTask类型）。</p> <p>a. 如果任务是一个启用的&quot;transition&quot;，并且_enabledTasks和_busyTasks都不包含该任务，则将其添加到enabledTransitions集合中。</p> <p>b. 如果任务不是（或不再是）一个启用的transition，且之前已被引擎启用，则必须撤销该任务。调用withdrawEnabledTask方法，传入任务和pmgr作为参数。</p> <p>c. 如果任务处于忙碌状态，且_busyTasks不包含该任务，则记录一个错误信息，表示列表不同步，并抛出一个运行时异常，指出忙碌任务列表与忙碌任务不同步。</p></li> <li><p>如果enabledTransitions集合不为空，则调用fireTasks方法，传入enabledTransitions和pmgr作为参数，以触发一组启用的“transition”。</p></li> <li><p>更新_busyTasks为_net中的忙碌任务。</p></li> <li><p>返回是否有活动任务（调用hasActiveTasks方法）。</p></li></ol> <p>下图是引用<code>continueIfPossible</code>方法调用和被调用的链路关系。</p> <img src="/assets/img/4.2.6 yawl-continueIfPossible.9b42b2cc.png" alt="image-20240320130249443" style="zoom:67%;"> <p>路径：https://github.com/yawlfoundation/yawl/blob/b8196a160f5f950f9241e09e5d1abc6c058756e8/src/org/yawlfoundation/yawl/engine/YNetRunner.java#L537</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">continueIfPossible</span><span class="token punctuation">(</span><span class="token class-name">YPersistenceManager</span> pmgr<span class="token punctuation">)</span>
           <span class="token keyword">throws</span> <span class="token class-name">YDataStateException</span><span class="token punctuation">,</span> <span class="token class-name">YStateException</span><span class="token punctuation">,</span> <span class="token class-name">YQueryException</span><span class="token punctuation">,</span>
                  <span class="token class-name">YPersistenceException</span> <span class="token punctuation">{</span>
        _logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;--&gt; continueIfPossible&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Check if we are suspending (or suspended?) and if so exit out as we</span>
        <span class="token comment">// shouldn't post new workitems</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInSuspense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Aborting runner continuation as case is currently suspending/suspended&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// don't continue if the net has already finished</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token comment">// storage for the running set of enabled tasks</span>
        <span class="token class-name">YEnabledTransitionSet</span> enabledTransitions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YEnabledTransitionSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// iterate through the full set of tasks for the net</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">YTask</span> task <span class="token operator">:</span> _netTasks<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// if this task is an enabled 'transition'</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">t_enabled</span><span class="token punctuation">(</span>_caseIDForNet<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token punctuation">(</span>_enabledTasks<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span> <span class="token operator">||</span> _busyTasks<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    enabledTransitions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>

                <span class="token comment">// if the task is not (or no longer) an enabled transition, and it</span>
                <span class="token comment">// has been previously enabled by the engine, then it must be withdrawn</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>_enabledTasks<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">withdrawEnabledTask</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> pmgr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">t_isBusy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>_busyTasks<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Throwing RTE for lists out of sync&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Busy task list out of synch with a busy task: &quot;</span>
                        <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; busy tasks: &quot;</span> <span class="token operator">+</span> _busyTasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// fire the set of enabled 'transitions' (if any)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> enabledTransitions<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">fireTasks</span><span class="token punctuation">(</span>enabledTransitions<span class="token punctuation">,</span> pmgr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        _busyTasks <span class="token operator">=</span> _net<span class="token punctuation">.</span><span class="token function">getBusyTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;-- continueIfPossible&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">hasActiveTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>在循环判断里面，该方法调用<code>t_enabled</code>函数来判断每一个任务是否可被激活，这是一个很关键的算法，该算法的实现正是基于Petri网的令牌机制实现的。</p> <h3 id="ytask类的t-enabled方法"><a href="#ytask类的t-enabled方法" class="header-anchor">#</a> YTask类的t_enabled方法</h3> <p><code>t_enabled</code>根据任务的_joinType（连接类型），执行以下操作：</p> <ol><li><p>如果_joinType为AND-JOIN方法（与连接）：</p> <ul><li><p>遍历任务的预设元素，如果其中的任何一个条件不包含标识符（即令牌token），则返回false。</p></li> <li><p>如果所有条件都包含标识符（即令牌token），则返回true。</p></li></ul></li> <li><p>如果_joinType为OR-JOIN方式（或连接）：</p> <ul><li>调用_net的orJoinEnabled方法，传入当前任务和id作为参数，并返回结果。</li></ul></li> <li><p>如果_joinType为XOR-方式（异或连接）：</p> <ul><li><p>遍历任务的预设元素（YExternalNetElement类型），如果其中的任何一个条件包含标识符（即令牌token），则返回true。</p></li> <li><p>如果没有条件包含标识符，则返回false。</p></li></ul></li> <li><p>如果_joinType为其他类型，则返回false。</p></li></ol> <p>下图是该方法调用和被调用的链路关系。</p> <img src="/assets/img/4.2.6 yawl-t_enabled上下游调用关系.73cbf2d5.png" alt="image-20240320130402339" style="zoom:50%;"> <p>路径：https://github.com/yawlfoundation/yawl/blob/master/src/org/yawlfoundation/yawl/stateless/elements/YTask.java#L917</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">t_enabled</span><span class="token punctuation">(</span><span class="token class-name">YIdentifier</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_i <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>     <span class="token comment">// busy tasks are never enabled</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>_joinType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token class-name">YTask</span><span class="token punctuation">.</span>_AND<span class="token operator">:</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">YExternalNetElement</span> condition <span class="token operator">:</span> <span class="token function">getPresetElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">YCondition</span><span class="token punctuation">)</span> condition<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">containsIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">YTask</span><span class="token punctuation">.</span>_OR<span class="token operator">:</span>
            <span class="token keyword">return</span> _net<span class="token punctuation">.</span><span class="token function">orJoinEnabled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">YTask</span><span class="token punctuation">.</span>_XOR<span class="token operator">:</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">YExternalNetElement</span> condition <span class="token operator">:</span> <span class="token function">getPresetElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">YCondition</span><span class="token punctuation">)</span> condition<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">containsIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的代码对应yawl中AND-JOIN、OR-JOIN和XOR-JOIN三种不同的连接类型，它们用于控制工作流的流程。具体来说：</p> <ol><li>AND-JOIN：这是一种同步连接，表示一个任务必须等待所有前置任务都完成后才能开始。在Petri网中，这对应于一个具有多个输入弧的变迁，其中每个输入弧都必须有一个令牌才能触发变迁。</li> <li>OR-JOIN：这是一种非同步连接，表示一个任务可以在一个或多个前置任务完成后开始。在Petri网中，这对应于一个具有多个输入弧的变迁，其中任何一个输入弧有令牌就可以触发变迁。</li> <li>XOR-JOIN：这是一种选择连接，表示一个任务在多个前置任务中只能由一个完成后才能开始，有排他性。在Petri网中，这对应于一个具有多个输入弧的变迁，其中只能有一个输入弧有令牌才能触发变迁。</li></ol> <p>这三种连接类型提供了对工作流流程的精细控制，使得YAWL能够表示各种复杂的业务逻辑。</p> <blockquote><p>YNet类的orJoinEnabled方法</p></blockquote> <p>我们继续看OR-JOIN链接中调用的_net.orJoinEnabled方法。该方法返回一个布尔值，表示是否启用了或连接。</p> <ol><li><p>首先，检查orJoinTask和caseID是否为null。如果它们中的任何一个为null，则抛出一个运行时异常，表示在调用具有空参数的情况下检查或连接的启用性是无关紧要的。</p></li> <li><p>接下来，检查orJoinTask的连接类型是否为YTask._OR（或连接）。如果不是，则抛出一个运行时异常，表示orJoinTask不是一个或连接。</p></li> <li><p>创建一个名为actualMarking的YMarking对象，传入caseID作为参数。然后创建一个名为locations的YNetElement类型的列表，用于存储actualMarking中的位置。</p></li> <li><p>获取orJoinTask的预设元素集合preSet。如果locations包含preSet的所有元素，则返回true。</p></li> <li><p>遍历locations中的每个YNetElement类型的元素。如果preSet包含该元素，则执行以下操作：</p> <p>a. 创建一个名为e2Net的E2WFOJNet对象，传入当前对象（this）和orJoinTask作为参数。</p> <p>b. 调用e2Net的restrictNet方法，分别传入actualMarking和orJoinTask作为参数。</p> <p>c. 调用e2Net的orJoinEnabled方法，传入actualMarking和orJoinTask作为参数，并返回结果。</p> <p>如果在执行这些操作时发生异常，抛出一个运行时异常，表示在或连接调用中出现异常。</p></li> <li><p>如果执行到这一步，说明或连接任务在预设中没有令牌，返回false。</p></li></ol> <img src="/assets/img/4.2.6 yawl-ynet的orJoinEnabled调用关系.492b0dcb.png" alt="image-20240320130930593" style="zoom:50%;"> <p>路径：https://github.com/yawlfoundation/yawl/blob/master/src/org/yawlfoundation/yawl/elements/YNet.java#L346</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">orJoinEnabled</span><span class="token punctuation">(</span><span class="token class-name">YTask</span> orJoinTask<span class="token punctuation">,</span> <span class="token class-name">YIdentifier</span> caseID<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>orJoinTask <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> caseID <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Irrelevant to check the enabledness of an &quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;or join if this is called with null params.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>orJoinTask<span class="token punctuation">.</span><span class="token function">getJoinType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">YTask</span><span class="token punctuation">.</span>_OR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>orJoinTask <span class="token operator">+</span> <span class="token string">&quot; is not an OR-Join.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">YMarking</span> actualMarking <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YMarking</span><span class="token punctuation">(</span>caseID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">YNetElement</span><span class="token punctuation">&gt;</span></span> locations <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">YNetElement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>actualMarking<span class="token punctuation">.</span><span class="token function">getLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span> preSet <span class="token operator">=</span> orJoinTask<span class="token punctuation">.</span><span class="token function">getPresetElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>locations<span class="token punctuation">.</span><span class="token function">containsAll</span><span class="token punctuation">(</span>preSet<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">YNetElement</span> element <span class="token operator">:</span> locations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>preSet<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">E2WFOJNet</span> e2Net <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">E2WFOJNet</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> orJoinTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
                e2Net<span class="token punctuation">.</span><span class="token function">restrictNet</span><span class="token punctuation">(</span>actualMarking<span class="token punctuation">)</span><span class="token punctuation">;</span>
                e2Net<span class="token punctuation">.</span><span class="token function">restrictNet</span><span class="token punctuation">(</span>orJoinTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> e2Net<span class="token punctuation">.</span><span class="token function">orJoinEnabled</span><span class="token punctuation">(</span>actualMarking<span class="token punctuation">,</span> orJoinTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Exception in OR-join call:&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// or join task has no tokens in preset</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里你可能会好奇OR-JOIN不是只要有一个前置任务完成就满足启用条件了吗？为什么下面要判断是否所有前置任务的条件都满足。</p> <div class="language- extra-class"><pre class="language-text"><code>if (locations.containsAll(preSet)) {
    return true;
}
</code></pre></div><p>这是因为，在这个特定的上下文中，<code>locations.containsAll(preSet)</code>返回<code>true</code>表示所有的前置任务（即预设元素）都已经完成。这意味着OR-JOIN任务可以被启用，因为OR-JOIN的定义是只要有一个或多个前置任务完成，就可以启用，这里很好理解。</p> <p>然而，如果并非所有的前置任务都完成，就需要进行更复杂的检查来确定是否可以启用OR-JOIN任务。这是因为在某些情况下，即使并非所有的前置任务都完成，OR-JOIN任务也可能可以启用。例如，如果前置任务之间存在某种依赖关系，那么完成了一部分前置任务可能就足够启用OR-JOIN任务了。</p> <p>这个检查的目的是为了优化性能：如果所有的前置任务都已经完成，那么就可以立即确定OR-JOIN任务可以启用，无需进行更复杂的检查（调用E2WFOJNet类的orJoinEnabled方法）。只有在需要时，才进行更复杂的检查。</p> <p>下面我们看E2WFOJNet的orJoinEnabled方法实现原理，就知道其复杂度了。</p> <blockquote><p>E2WFOJNet类的orJoinEnabled方法</p></blockquote> <p>路径：https://github.com/yawlfoundation/yawl/blob/master/src/org/yawlfoundation/yawl/elements/e2wfoj/E2WFOJNet.java#L728</p> <p>该方法返回一个布尔值，表示在给定的标记（即当前状态）下是否应启用具有或连接的任务。</p> <p>下图是该方法调用和被调用的链路关系。</p> <img src="/assets/img/4.2.6 yawl的e2wfojnet的orJoinEnabled调用关系.704659c0.png" alt="image-20240320131019700" style="zoom:50%;"> <ol><li>首先，创建两个新的集合：MarkedTasks和RMap。MarkedTasks用于存储标记的任务，RMap用于存储转换后的标记。</li> <li>接下来，遍历M中的所有位置。对于每个位置，如果它是一个条件（YCondition类型），则获取对应的地方（RPlace类型），并在RMap中添加或更新该地方的令牌计数。如果位置是一个任务（YTask类型），则将其添加到MarkedTasks集合中。</li> <li>然后，遍历MarkedTasks中的每个任务，将其转换为相应的地方，并在RMap中添加该地方的令牌计数。</li> <li>创建一个新的RMarking对象RM，表示转换后的标记，并清空RMap。</li> <li>生成或连接的biggerEnabling标记。对于或连接的每个预设元素，如果它在M中被标记，则在newMap中添加一个令牌。否则，将其添加到emptyPreSetPlaces集合中。</li> <li>对于emptyPreSetPlaces中的每个地方，添加一个令牌，并将结果标记添加到Y集合中。</li> <li>最后，遍历Y中的每个标记。如果RM可以覆盖当前标记，则返回false。如果没有标记可以被覆盖，则返回true。</li></ol> <p>这个方法的主要思想是将YAWL模型转换为ResetNet模型，然后使用Coverable函数来检查在给定标记下是否应启用OR-JOIN或连接。这是因为在ResetNet模型中，OR-JOIN或连接的启用规则更容易处理。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
   * This method is used to determine whether 
   * an OrJoin task of a YAWL net should be enabled at 
   * a given marking. The method returns TRUE if an OrJoin 
   * should be enabled at the given marking and FALSE, otherwise.
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">orJoinEnabled</span><span class="token punctuation">(</span><span class="token class-name">YMarking</span> <span class="token class-name">M</span><span class="token punctuation">,</span><span class="token class-name">YTask</span> orJoin<span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token class-name">Set</span> <span class="token class-name">MarkedTasks</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Map</span> <span class="token class-name">RMap</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//Need to convert from YAWL to ResetNet</span>
  <span class="token class-name">List</span> <span class="token class-name">YLocations</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token class-name">M</span><span class="token punctuation">.</span><span class="token function">getLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span> i <span class="token operator">=</span> <span class="token class-name">YLocations</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span>    
     <span class="token punctuation">{</span> <span class="token class-name">YNetElement</span> nextElement <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">YNetElement</span><span class="token punctuation">)</span> i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nextElement <span class="token keyword">instanceof</span> <span class="token class-name">YCondition</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span> <span class="token class-name">YCondition</span> condition <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">YCondition</span><span class="token punctuation">)</span> nextElement<span class="token punctuation">;</span>    
        <span class="token class-name">RPlace</span> place <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RPlace</span><span class="token punctuation">)</span> _Places<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>condition<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>place <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token class-name">String</span> placename <span class="token operator">=</span> place<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">Integer</span> tokenCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">RMap</span><span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>placename<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span> <span class="token class-name">Object</span> value <span class="token operator">=</span> <span class="token class-name">RMap</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>placename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> countString <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> countString<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        count <span class="token operator">++</span><span class="token punctuation">;</span>
        tokenCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token punctuation">}</span>
        <span class="token class-name">RMap</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>placename<span class="token punctuation">,</span>tokenCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nextElement <span class="token keyword">instanceof</span> <span class="token class-name">YTask</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>   <span class="token class-name">MarkedTasks</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>nextElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>    

      <span class="token punctuation">}</span>  <span class="token comment">//endfor</span>


    <span class="token comment">//To convert the active tasks in the marking into appropriate places  </span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span> placeConvIter <span class="token operator">=</span> <span class="token class-name">MarkedTasks</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> placeConvIter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  <span class="token class-name">YTask</span> task <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">YTask</span><span class="token punctuation">)</span> placeConvIter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">String</span> internalPlace <span class="token operator">=</span> <span class="token string">&quot;p_&quot;</span><span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">RPlace</span> place <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RPlace</span><span class="token punctuation">)</span> _Places<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>internalPlace<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>place <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">String</span> placename <span class="token operator">=</span> place<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">Integer</span> tokenCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">RMap</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>placename<span class="token punctuation">,</span>tokenCount<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>   
<span class="token comment">// Equivalent Reset net marking     </span>
    <span class="token class-name">RMarking</span> <span class="token constant">RM</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RMarking</span><span class="token punctuation">(</span><span class="token class-name">RMap</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RMap</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  


  <span class="token comment">// Generate biggerEnabling markings for OJ</span>
  <span class="token class-name">Set</span> <span class="token class-name">X</span> <span class="token operator">=</span> orJoin<span class="token punctuation">.</span><span class="token function">getPresetElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Map</span> newMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Set</span> emptyPreSetPlaces <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token class-name">Integer</span> tokenCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span> x <span class="token operator">=</span> <span class="token class-name">X</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> x<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span>    
  <span class="token punctuation">{</span>   <span class="token class-name">YCondition</span> preSetCondition <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">YCondition</span><span class="token punctuation">)</span> x<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RPlace</span> preSetPlace <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RPlace</span><span class="token punctuation">)</span> _Places<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>preSetCondition<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>preSetPlace <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>    	
    <span class="token punctuation">{</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">YLocations</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>preSetCondition<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span> 
        <span class="token comment">//Add one token for each marked place</span>
         <span class="token class-name">String</span> preSetPlaceName <span class="token operator">=</span> preSetPlace<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         newMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>preSetPlaceName<span class="token punctuation">,</span>tokenCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> 
      <span class="token punctuation">{</span>  emptyPreSetPlaces<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>preSetPlace<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> <span class="token comment">//end for</span>


  <span class="token class-name">RSetOfMarkings</span> <span class="token class-name">Y</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RSetOfMarkings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span> i <span class="token operator">=</span> emptyPreSetPlaces<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span>    
  <span class="token punctuation">{</span>   <span class="token class-name">RPlace</span> q <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RPlace</span><span class="token punctuation">)</span> i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Add one token for exactly one empty place</span>
      tokenCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> qname <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>qname<span class="token punctuation">,</span>tokenCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">RMarking</span> <span class="token class-name">M_w</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RMarking</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span>newMap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token class-name">Y</span><span class="token punctuation">.</span><span class="token function">addMarking</span><span class="token punctuation">(</span><span class="token class-name">M_w</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      newMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>qname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span> i <span class="token operator">=</span> <span class="token class-name">Y</span><span class="token punctuation">.</span><span class="token function">getMarkings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>   <span class="token class-name">RMarking</span> <span class="token class-name">M_w</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RMarking</span><span class="token punctuation">)</span> i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Coverable</span><span class="token punctuation">(</span><span class="token constant">RM</span><span class="token punctuation">,</span><span class="token class-name">M_w</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>  
         <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="ynetrunner类的firetasks方法"><a href="#ynetrunner类的firetasks方法" class="header-anchor">#</a> YNetRunner类的fireTasks方法</h3> <p>我们接着看<code>continueIfPossible</code>方法里调用的<code>fireTasks</code>方法。下图是该方法被调用和调用的链路关系。</p> <img src="/assets/img/4.2.6 yawl-fireTasks的calls和callers.075f162c.png" alt="image-20240320130005817" style="zoom:50%;"> <p>这个方法的核心思想是根据任务组的类型（复合任务、空任务或原子任务）来触发相应的任务。对于复合任务和空任务，只触发任务组中的一个任务；对于原子任务，触发任务组中的所有任务。这样可以确保在遇到不同类型的任务时，工作流引擎能够采取适当的行动。</p> <ol><li><p>首先，创建一个名为enabledTasks的HashSet，用于存储已启用的任务。</p></li> <li><p>然后，遍历enabledSet中的所有任务组（YEnabledTransitionSet.TaskGroup类型）。任务组是一组由单个条件启用的所有任务。对于每个任务组：</p> <p>a. 如果任务组包含复合任务（YCompositeTask类型），则从任务组中随机选择一个复合任务并触发它。如果该复合任务尚未启用且尚未到达网络的末尾，则调用fireCompositeTask方法来触发复合任务，并将其添加到enabledTasks集合中。</p> <p>b. 如果任务组包含空任务（YAtomicTask类型），则从任务组中随机选择一个空任务并处理它。如果该空任务尚未启用且尚未到达网络的末尾，则调用processEmptyTask方法来处理空任务。</p> <p>c. 否则（即任务组中的任务都是原子任务），遍历任务组中的所有原子任务（YAtomicTask类型）。对于每个原子任务，如果该任务尚未启用且尚未到达网络的末尾，则调用fireAtomicTask方法来触发原子任务，并将其添加到enabledTasks集合中。如果fireAtomicTask方法返回一个YAnnouncement对象，则将其添加到_announcements集合中。</p></li></ol> <p>如下图，从源码的我们知道YAtomicTask和YCompositeTask继承自YTask类。</p> <img src="/assets/img/4.2.6 yawl-YTask继承结构.871bc69f.png" alt="image-20240320125335437" style="zoom:50%;"> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fireTasks</span><span class="token punctuation">(</span><span class="token class-name">YEnabledTransitionSet</span> enabledSet<span class="token punctuation">,</span> <span class="token class-name">YPersistenceManager</span> pmgr<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">YDataStateException</span><span class="token punctuation">,</span> <span class="token class-name">YStateException</span><span class="token punctuation">,</span> <span class="token class-name">YQueryException</span><span class="token punctuation">,</span>
               <span class="token class-name">YPersistenceException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">YTask</span><span class="token punctuation">&gt;</span></span> enabledTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">YTask</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// A TaskGroup is a group of tasks that are all enabled by a single condition.</span>
    <span class="token comment">// If the group has more than one task, it's a deferred choice, in which case:</span>
    <span class="token comment">// 1. If any are composite, fire one (chosen randomly) - rest are withdrawn</span>
    <span class="token comment">// 2. Else, if any are empty, fire one (chosen randomly) - rest are withdrawn</span>
    <span class="token comment">// 3. Else, fire and announce all enabled atomic tasks to the environment</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">YEnabledTransitionSet<span class="token punctuation">.</span>TaskGroup</span> group <span class="token operator">:</span> enabledSet<span class="token punctuation">.</span><span class="token function">getAllTaskGroups</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>group<span class="token punctuation">.</span><span class="token function">hasCompositeTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">YCompositeTask</span> composite <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">getRandomCompositeTaskFromGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token punctuation">(</span>enabledTasks<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>composite<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">endOfNetReached</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">fireCompositeTask</span><span class="token punctuation">(</span>composite<span class="token punctuation">,</span> pmgr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                enabledTasks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>composite<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>group<span class="token punctuation">.</span><span class="token function">hasEmptyTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">YAtomicTask</span> atomic <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">getRandomEmptyTaskFromGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token punctuation">(</span>enabledTasks<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>atomic<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">endOfNetReached</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">processEmptyTask</span><span class="token punctuation">(</span>atomic<span class="token punctuation">,</span> pmgr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> groupID <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">getDeferredChoiceID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// null if &lt;2 tasks</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">YAtomicTask</span> atomic <span class="token operator">:</span> group<span class="token punctuation">.</span><span class="token function">getAtomicTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token punctuation">(</span>enabledTasks<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>atomic<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">endOfNetReached</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">YAnnouncement</span> announcement <span class="token operator">=</span> <span class="token function">fireAtomicTask</span><span class="token punctuation">(</span>atomic<span class="token punctuation">,</span> groupID<span class="token punctuation">,</span> pmgr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>announcement <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        _announcements<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>announcement<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>    
                    enabledTasks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>atomic<span class="token punctuation">)</span> <span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里我们看到调用fireCompositeTask和fireAtomicTask方法来处理YCompositeTask对象和YAtomicTask对象。</p> <h3 id="ynetrunner类的firecompositetask方法"><a href="#ynetrunner类的firecompositetask方法" class="header-anchor">#</a> YNetRunner类的fireCompositeTask方法</h3> <img src="/assets/img/4.2.6 yawl-fireCompositeTask调用关系.b7ff8850.png" alt="image-20240320130644031" style="zoom:50%;"> <p>路径：yawl/src/org/yawlfoundation/yawl/engine/YNetRunner.java</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fireCompositeTask</span><span class="token punctuation">(</span><span class="token class-name">YCompositeTask</span> task<span class="token punctuation">,</span> <span class="token class-name">YPersistenceManager</span> pmgr<span class="token punctuation">)</span>
                  <span class="token keyword">throws</span> <span class="token class-name">YDataStateException</span><span class="token punctuation">,</span> <span class="token class-name">YStateException</span><span class="token punctuation">,</span> <span class="token class-name">YQueryException</span><span class="token punctuation">,</span>
                         <span class="token class-name">YPersistenceException</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> _busyTasks<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">// don't proceed if task already started</span>
        _busyTasks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _busyTaskNames<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pmgr <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> pmgr<span class="token punctuation">.</span><span class="token function">updateObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">YIdentifier</span><span class="token punctuation">&gt;</span></span> caseIDs <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">t_fire</span><span class="token punctuation">(</span>pmgr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">YIdentifier</span> id <span class="token operator">:</span> caseIDs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                task<span class="token punctuation">.</span><span class="token function">t_start</span><span class="token punctuation">(</span>pmgr<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">YDataStateException</span> ydse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                task<span class="token punctuation">.</span><span class="token function">rollbackFired</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> pmgr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ydse<span class="token punctuation">.</span><span class="token function">rethrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>路径：yawl/src/org/yawlfoundation/yawl/elements/YTask.java</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">t_start</span><span class="token punctuation">(</span><span class="token class-name">YPersistenceManager</span> pmgr<span class="token punctuation">,</span> <span class="token class-name">YIdentifier</span> child<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">YDataStateException</span><span class="token punctuation">,</span> <span class="token class-name">YPersistenceException</span><span class="token punctuation">,</span>
        <span class="token class-name">YQueryException</span><span class="token punctuation">,</span> <span class="token class-name">YStateException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">t_isBusy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">startOne</span><span class="token punctuation">(</span>pmgr<span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>startOne这里是调用的YCompositeTask的方法，如下。</p> <p>该方法启动一个复合任务，主要是设置令牌位置：将任务标识符添加到 _mi_executing 集合中（表示任务正在执行），并从 _mi_entered 集合中移除（表示任务已进入但尚未开始执行）。</p> <p>路径：yawl/src/org/yawlfoundation/yawl/elements/YCompositeTask.java</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">startOne</span><span class="token punctuation">(</span><span class="token class-name">YPersistenceManager</span> pmgr<span class="token punctuation">,</span> <span class="token class-name">YIdentifier</span> id<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">YDataStateException</span><span class="token punctuation">,</span> <span class="token class-name">YPersistenceException</span><span class="token punctuation">,</span> <span class="token class-name">YQueryException</span><span class="token punctuation">,</span> <span class="token class-name">YStateException</span> <span class="token punctuation">{</span>

    <span class="token comment">// set token locations</span>
    _mi_executing<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pmgr<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _mi_entered<span class="token punctuation">.</span><span class="token function">removeOne</span><span class="token punctuation">(</span>pmgr<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// create a net runner for this task's contained subnet</span>
    <span class="token class-name">YNetRunner</span> netRunner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YNetRunner</span><span class="token punctuation">(</span>pmgr<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">YNet</span><span class="token punctuation">)</span> _decompositionPrototype<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token function">getData</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getNetRunnerRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>netRunner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">logTaskStart</span><span class="token punctuation">(</span>netRunner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    netRunner<span class="token punctuation">.</span><span class="token function">continueIfPossible</span><span class="token punctuation">(</span>pmgr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    netRunner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>pmgr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这两行代码分别表示将任务标识符（<code>id</code>）从一个集合（<code>_mi_entered</code>）移动到另一个集合（<code>_mi_executing</code>）。</p> <ul><li><code>_mi_entered</code> 集合表示已进入但尚未开始执行的任务。当一个任务的前置条件满足时，任务会进入这个集合。</li> <li><code>_mi_executing</code> 集合表示正在执行的任务。当任务开始执行时，它会从 <code>_mi_entered</code> 集合移动到 <code>_mi_executing</code> 集合。</li></ul> <p>这个令牌迁移过程反映了任务在工作流实例中的状态变化。当任务从一个状态迁移到另一个状态时，令牌会在相应的集合之间移动。</p> <div class="language-java extra-class"><pre class="language-java"><code>_mi_executing<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pmgr<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
_mi_entered<span class="token punctuation">.</span><span class="token function">removeOne</span><span class="token punctuation">(</span>pmgr<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ytask内部条件状态流转"><a href="#ytask内部条件状态流转" class="header-anchor">#</a> YTask内部条件状态流转</h3> <p>一个YTask任务在被激活以后，从开始运行到结束运行这个过程，YAWL在这中间还定义了一系列的状态流转。理解这个转态的流转生命周期，能加深对YAWL的PetriNet算法整个执行过程。</p> <p>YTask内部的转态流转支持的状态定义在下面源码里：</p> <p>路径：yawl/src/org/yawlfoundation/yawl/elements/YTask.java</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">YTask</span> <span class="token keyword">extends</span> <span class="token class-name">YExternalNetElement</span> <span class="token punctuation">{</span>

    <span class="token comment">//class members</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Random</span> _random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _AND <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _OR <span class="token operator">=</span> <span class="token number">103</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _XOR <span class="token operator">=</span> <span class="token number">126</span><span class="token punctuation">;</span>

    <span class="token comment">//internal state nodes</span>
    <span class="token keyword">protected</span> <span class="token class-name">YIdentifier</span> _i<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">YInternalCondition</span> _mi_active <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YInternalCondition</span><span class="token punctuation">(</span><span class="token class-name">YInternalCondition</span><span class="token punctuation">.</span>_mi_active<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">YInternalCondition</span> _mi_entered <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YInternalCondition</span><span class="token punctuation">(</span><span class="token class-name">YInternalCondition</span><span class="token punctuation">.</span>_mi_entered<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">YInternalCondition</span> _mi_complete <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YInternalCondition</span><span class="token punctuation">(</span><span class="token class-name">YInternalCondition</span><span class="token punctuation">.</span>_mi_complete<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">YInternalCondition</span> _mi_executing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YInternalCondition</span><span class="token punctuation">(</span><span class="token class-name">YInternalCondition</span><span class="token punctuation">.</span>_mi_executing<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>内部条件有以下四种状态，用字符串常量表示：</p> <ul><li><code>mi_active</code>：表示任务实例已经被激活，但可能还没有开始执行。</li> <li><code>mi_entered</code>：表示任务实例已经进入，但还没有开始执行。当任务实例的前置条件满足时，它会进入这个状态。</li> <li><code>mi_executing</code>：表示任务实例正在执行。当任务实例开始执行时，它会进入这个状态。</li> <li><code>mi_complete</code>：表示任务实例已经完成。当任务实例完成所有操作时，它会进入这个状态。</li></ul> <p>如下是完整的状态流转过程：</p> <img src="/assets/img/4.2.6 yawl 状态流转.78585df9.png" alt="image-20240320200428680" style="zoom:67%;"> <img src="/assets/img/wechat.50adb4d4.png" style="zoom:15%;"></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">9/12/2024, 11:20:51 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/4.2.5-Petri网调度算法原理与实践.html" class="prev">
        4.2.5 Petri网调度算法原理与实践
      </a></span> <span class="next"><a href="/4.3-工作流模式-控制流模式.html">
        4.3 工作流模式-控制流模式
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b8820ad2.js" defer></script><script src="/assets/js/2.a6c4a04f.js" defer></script><script src="/assets/js/1.04b49174.js" defer></script><script src="/assets/js/11.36ba8367.js" defer></script>
  </body>
</html>
