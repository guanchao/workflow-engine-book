<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>资源调度机制介绍 | 流程引擎原理与实践</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?925c3dadc75643902ba1d4bef48fa406";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
        </script></script>
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="国内首本从工程角度系统性介绍流程引擎的技术体系">
    <meta name="baidu-site-verification" content="codeva-c7FETTq8fo">
    <meta name="keywords" content="开源电子书，工作流技术体系，流程引擎技术体系，工作流，流程引擎，事件驱动机制，权限系统设计，云原生工作流，Crontab工作流，工作流系统架构，流程建模，DAG，FSM，WFMC，BPMN，BPM，Airflow，OsWorkflow，Petri">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.b8820ad2.js" as="script"><link rel="preload" href="/assets/js/2.a6c4a04f.js" as="script"><link rel="preload" href="/assets/js/1.04b49174.js" as="script"><link rel="preload" href="/assets/js/13.9964bf6f.js" as="script"><link rel="prefetch" href="/assets/js/10.01c85a43.js"><link rel="prefetch" href="/assets/js/11.36ba8367.js"><link rel="prefetch" href="/assets/js/12.49270403.js"><link rel="prefetch" href="/assets/js/14.1ffdb2cc.js"><link rel="prefetch" href="/assets/js/15.3ec6e020.js"><link rel="prefetch" href="/assets/js/16.223f06e4.js"><link rel="prefetch" href="/assets/js/17.49a0611a.js"><link rel="prefetch" href="/assets/js/18.5e539e58.js"><link rel="prefetch" href="/assets/js/19.08beb14f.js"><link rel="prefetch" href="/assets/js/20.2fd50ddb.js"><link rel="prefetch" href="/assets/js/21.94815126.js"><link rel="prefetch" href="/assets/js/22.7335372f.js"><link rel="prefetch" href="/assets/js/23.efd43c2e.js"><link rel="prefetch" href="/assets/js/24.33511251.js"><link rel="prefetch" href="/assets/js/25.9103752e.js"><link rel="prefetch" href="/assets/js/26.be3c6fce.js"><link rel="prefetch" href="/assets/js/27.a66d9ab9.js"><link rel="prefetch" href="/assets/js/28.db24d1a7.js"><link rel="prefetch" href="/assets/js/29.e639cc41.js"><link rel="prefetch" href="/assets/js/3.8ee85a39.js"><link rel="prefetch" href="/assets/js/30.9f96cad1.js"><link rel="prefetch" href="/assets/js/31.76245b5d.js"><link rel="prefetch" href="/assets/js/32.01a0bbd7.js"><link rel="prefetch" href="/assets/js/33.6cb05ad6.js"><link rel="prefetch" href="/assets/js/34.370a24a6.js"><link rel="prefetch" href="/assets/js/35.83692dfe.js"><link rel="prefetch" href="/assets/js/36.c783d15a.js"><link rel="prefetch" href="/assets/js/37.ac210fe0.js"><link rel="prefetch" href="/assets/js/38.07dc64eb.js"><link rel="prefetch" href="/assets/js/39.4ef28dca.js"><link rel="prefetch" href="/assets/js/4.9d17ba4d.js"><link rel="prefetch" href="/assets/js/40.a8fcb556.js"><link rel="prefetch" href="/assets/js/41.98d7d1f0.js"><link rel="prefetch" href="/assets/js/42.e31dd182.js"><link rel="prefetch" href="/assets/js/43.822702b0.js"><link rel="prefetch" href="/assets/js/44.50c68594.js"><link rel="prefetch" href="/assets/js/45.4e32699e.js"><link rel="prefetch" href="/assets/js/46.09f04e77.js"><link rel="prefetch" href="/assets/js/47.35c13096.js"><link rel="prefetch" href="/assets/js/48.99dfb60f.js"><link rel="prefetch" href="/assets/js/49.e1984c48.js"><link rel="prefetch" href="/assets/js/5.5682b71e.js"><link rel="prefetch" href="/assets/js/50.4242e15e.js"><link rel="prefetch" href="/assets/js/51.bdee7514.js"><link rel="prefetch" href="/assets/js/52.3b23c6f4.js"><link rel="prefetch" href="/assets/js/53.b6798440.js"><link rel="prefetch" href="/assets/js/54.ac356f09.js"><link rel="prefetch" href="/assets/js/55.79840f1c.js"><link rel="prefetch" href="/assets/js/56.343306c2.js"><link rel="prefetch" href="/assets/js/57.90f7511a.js"><link rel="prefetch" href="/assets/js/58.59457ff7.js"><link rel="prefetch" href="/assets/js/59.a05e2b0c.js"><link rel="prefetch" href="/assets/js/6.6aa986f5.js"><link rel="prefetch" href="/assets/js/60.7d6e698d.js"><link rel="prefetch" href="/assets/js/61.d1952570.js"><link rel="prefetch" href="/assets/js/62.a15b1cb5.js"><link rel="prefetch" href="/assets/js/63.69030ee5.js"><link rel="prefetch" href="/assets/js/64.a60b63a8.js"><link rel="prefetch" href="/assets/js/65.c1986cb9.js"><link rel="prefetch" href="/assets/js/66.e5747c76.js"><link rel="prefetch" href="/assets/js/67.c7de5e6a.js"><link rel="prefetch" href="/assets/js/68.96f4e3c6.js"><link rel="prefetch" href="/assets/js/69.db66370e.js"><link rel="prefetch" href="/assets/js/7.1fb8aaeb.js"><link rel="prefetch" href="/assets/js/70.8962d544.js"><link rel="prefetch" href="/assets/js/71.695bacdf.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.7bd035a8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.png" alt="流程引擎原理与实践" class="logo"> <span class="site-name can-hide">流程引擎原理与实践</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="目录" class="dropdown-title"><span class="title">目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="目录" class="mobile-dropdown-title"><span class="title">目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/1-引言.html" class="nav-link">
  1 引言
</a></li><li class="dropdown-item"><!----> <a href="/2-概念.html" class="nav-link">
  2 概念
</a></li><li class="dropdown-item"><!----> <a href="/3-流程建模和解析.html" class="nav-link">
  3 流程建模和解析
</a></li><li class="dropdown-item"><!----> <a href="/4-流程引擎的核心组件.html" class="nav-link">
  4 流程引擎的核心组件
</a></li><li class="dropdown-item"><!----> <a href="/5-事件驱动机制.html" class="nav-link">
  5 事件驱动机制
</a></li><li class="dropdown-item"><!----> <a href="/6-核心表结构与接口设计.html" class="nav-link">
  6 核心表结构与接口设计
</a></li><li class="dropdown-item"><!----> <a href="/7-权限系统设计.html" class="nav-link">
  7 权限系统设计
</a></li><li class="dropdown-item"><!----> <a href="/8-分布式Crontab任务调度.html" class="nav-link">
  8 分布式Crontab任务调度
</a></li><li class="dropdown-item"><!----> <a href="/9-流程分析.html" class="nav-link">
  9 流程分析
</a></li><li class="dropdown-item"><!----> <a href="/10-云原生工作流.html" class="nav-link">
  10 云原生工作流
</a></li><li class="dropdown-item"><!----> <a href="/11-多引擎分布式系统实现.html" class="nav-link">
  11 多引擎分布式系统实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="帮助" class="dropdown-title"><span class="title">帮助</span> <span class="arrow down"></span></button> <button type="button" aria-label="帮助" class="mobile-dropdown-title"><span class="title">帮助</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  关于
</a></li><li class="dropdown-item"><!----> <a href="/sponsor.html" class="nav-link">
  打赏赞助
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/guanchao/workflow-engine-book" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="目录" class="dropdown-title"><span class="title">目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="目录" class="mobile-dropdown-title"><span class="title">目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/1-引言.html" class="nav-link">
  1 引言
</a></li><li class="dropdown-item"><!----> <a href="/2-概念.html" class="nav-link">
  2 概念
</a></li><li class="dropdown-item"><!----> <a href="/3-流程建模和解析.html" class="nav-link">
  3 流程建模和解析
</a></li><li class="dropdown-item"><!----> <a href="/4-流程引擎的核心组件.html" class="nav-link">
  4 流程引擎的核心组件
</a></li><li class="dropdown-item"><!----> <a href="/5-事件驱动机制.html" class="nav-link">
  5 事件驱动机制
</a></li><li class="dropdown-item"><!----> <a href="/6-核心表结构与接口设计.html" class="nav-link">
  6 核心表结构与接口设计
</a></li><li class="dropdown-item"><!----> <a href="/7-权限系统设计.html" class="nav-link">
  7 权限系统设计
</a></li><li class="dropdown-item"><!----> <a href="/8-分布式Crontab任务调度.html" class="nav-link">
  8 分布式Crontab任务调度
</a></li><li class="dropdown-item"><!----> <a href="/9-流程分析.html" class="nav-link">
  9 流程分析
</a></li><li class="dropdown-item"><!----> <a href="/10-云原生工作流.html" class="nav-link">
  10 云原生工作流
</a></li><li class="dropdown-item"><!----> <a href="/11-多引擎分布式系统实现.html" class="nav-link">
  11 多引擎分布式系统实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="帮助" class="dropdown-title"><span class="title">帮助</span> <span class="arrow down"></span></button> <button type="button" aria-label="帮助" class="mobile-dropdown-title"><span class="title">帮助</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  关于
</a></li><li class="dropdown-item"><!----> <a href="/sponsor.html" class="nav-link">
  打赏赞助
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/guanchao/workflow-engine-book" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第一部份：流程引擎基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>第二部份：流程引擎实现</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>4 流程引擎的核心组件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/4.1-WFMC工作流参考模型.html" class="sidebar-link">4.1 WFMC工作流参考模型</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>4.2 任务调度机制</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/4.3-工作流模式-控制流模式.html" class="sidebar-link">4.3 工作流模式-控制流模式</a></li><li><a href="/4.4-资源调度机制-资源模式.html" class="active sidebar-link">4.4 资源调度机制-资源模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/4.4-资源调度机制-资源模式.html#资源调度机制介绍" class="sidebar-link">资源调度机制介绍</a></li><li class="sidebar-sub-header"><a href="/4.4-资源调度机制-资源模式.html#bpm中的任务分配" class="sidebar-link">BPM中的任务分配</a></li><li class="sidebar-sub-header"><a href="/4.4-资源调度机制-资源模式.html#资源与类别" class="sidebar-link">资源与类别</a></li><li class="sidebar-sub-header"><a href="/4.4-资源调度机制-资源模式.html#资源分配模式" class="sidebar-link">资源分配模式</a></li><li class="sidebar-sub-header"><a href="/4.4-资源调度机制-资源模式.html#资源调度框架" class="sidebar-link">资源调度框架</a></li><li class="sidebar-sub-header"><a href="/4.4-资源调度机制-资源模式.html#车间调度问题" class="sidebar-link">车间调度问题</a></li><li class="sidebar-sub-header"><a href="/4.4-资源调度机制-资源模式.html#资源调度算法" class="sidebar-link">资源调度算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/4.4-资源调度机制-资源模式.html#遗传算法" class="sidebar-link">遗传算法</a></li><li class="sidebar-sub-header"><a href="/4.4-资源调度机制-资源模式.html#蚁群算法" class="sidebar-link">蚁群算法</a></li><li class="sidebar-sub-header"><a href="/4.4-资源调度机制-资源模式.html#粒子群算法" class="sidebar-link">粒子群算法</a></li><li class="sidebar-sub-header"><a href="/4.4-资源调度机制-资源模式.html#模拟退火算法" class="sidebar-link">模拟退火算法</a></li></ul></li></ul></li><li><a href="/4.5-数据管理机制-数据模式.html" class="sidebar-link">4.5 数据管理机制-数据模式</a></li><li><a href="/4.6-异常处理机制-异常处理模式.html" class="sidebar-link">4.6 异常处理机制-异常处理模式</a></li><li><a href="/4.7-引擎执行模式.html" class="sidebar-link">4.7 引擎执行模式</a></li></ul></section></li><li><a href="/5-事件驱动机制.html" class="sidebar-link">5 事件驱动机制</a></li><li><a href="/6-核心表结构与接口设计.html" class="sidebar-link">6 核心表结构与接口设计</a></li><li><a href="/7-权限系统设计.html" class="sidebar-link">7 权限系统设计</a></li><li><a href="/8-分布式Crontab任务调度.html" class="sidebar-link">8 分布式Crontab任务调度</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第三部份：流程引擎进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="资源调度机制介绍"><a href="#资源调度机制介绍" class="header-anchor">#</a> 资源调度机制介绍</h2> <p>我在引言章节中概括了流程引擎本质上是解决两个功能。前面内容介绍的任务调度算法（包括DAG、FSM和Petri网算法）是解决第一个问题，而第二个问题就是本章要介绍的资源调度机制。这两个功能是引擎的核心，特别是资源调度机制，这个更是系统实现降本增效的关键。</p> <p>（1）以什么样的顺序执行任务</p> <p>（2）决定由谁（资源）执行哪个任务</p> <p>资源调度机制，在互联网和制造业领域有很广泛的应用，例如像外卖系统、滴滴打车系统以及车间调度系统，都涉及到人力和机器的资源调度，这块更是这些厂家的核心技术所在。例如下面百度外卖技术团队分享的<strong>外卖订单调度系统</strong>、以及某个厂家的车间调度系统。</p> <img src="/assets/img/4.4 baidu外卖调度模型.4c53a8c8.png" alt="image-20240906094423832" style="zoom:67%;"> <img src="/assets/img/4.4 车间调度系统.5b35043d.jpeg" alt="优化| 基于深度强化学习的复杂作业车间调度问题研究_运筹OR帷幄-商业新知"> <p>资源调度要从两个出发点进行考虑：</p> <ul><li>对企业来说，最关心的是成本问题，所以要有效协调和分配资源，来降低成本</li> <li>对用户（流程服务的用户）来说，服务质量放在首位，所以需要降低流程的总执行时间</li></ul> <p>所以，资源调度既可以对资源进行有效的协调和分配，降低企业的成本；又能快速、准确地完成任务，给用户一个更好的用户体验。要在两者之间实现一个很好的平衡，这就是资源调度算法要做的事情。</p> <p>如果工作项的启动交互是由用户发起的，那么参与者必须从其分配的队列中手动选择它来开始执行。如果启动交互是由系统启动的，则工作项将自动启动并放在参与者的已启动队列中执行操作。</p> <p>在工作项的初始分配完成后，拥有所需授权（或特权）的参与者可以进一步影响工作项的分配和执行。如果工作项目分配给他们，他/她可以重新分配（重新启动分配，从分配集中排除）；将其委派给其“团队”成员——最终向参与者的位置汇报的职位）；或跳过工作项目（无需首先启动即可立即完成）。如果工作项目已经启动，参与者可以将其重新分配（重新分配给他们的团队成员）。</p> <h2 id="bpm中的任务分配"><a href="#bpm中的任务分配" class="header-anchor">#</a> BPM中的任务分配</h2> <p>在业务流程管理（Business Process Management，简称BPM）中，任务分配是一个关键的环节，它决定了资源如何被有效地分配和使用。这个过程通常涉及到以下几个步骤：</p> <ul><li>资源定义：在BPM中，资源可以是人、设备、物料或者时间等。在定义资源时，需要明确每种资源的特性，如可用性、能力、成本等，也就是要把资源的能力量化。</li> <li>任务定义：定义工作流中的每一个任务，包括任务的类型、所需的资源、优先级、截止时间等。</li> <li>资源分配策略：定义资源分配的策略，如基于优先级的分配、基于成本的分配、基于时间的分配等。这些策略可以帮助系统在多个任务之间有效地分配资源。</li> <li>任务分配：根据资源分配策略，将任务分配给相应的资源。这个过程可以是自动的，也可以是手动的。</li></ul> <p>在BPM系统中，还可以通过设置角色和权限来控制资源的访问和使用。例如，可以设置只有特定角色的用户才能访问某个资源，或者只有特定角色的用户才能执行某个任务。这样可以保证资源的安全性，同时也可以提高工作流的效率。</p> <p>此外，BPM系统还可以通过数据分析和报告功能，帮助管理者了解资源使用的情况，从而做出更好的决策。例如，可以通过分析报告发现哪些资源被过度使用，哪些资源被闲置，然后调整资源分配策略，以提高资源的利用率。</p> <h2 id="资源与类别"><a href="#资源与类别" class="header-anchor">#</a> 资源与类别</h2> <blockquote><p>资源</p></blockquote> <p>资源是指可以执行某些任务的人或机器（可以物理的机器设备或软件里的AI机器人）。一般我们本书中谈论资源的时候，默认都是指人。</p> <p>当然在目前大模型的推动下，AI逐渐具备了基础的世界知识，以及专业领域的知识，例如GPT3.5和GPT4。而且现在的AI机器人已经具备跟人类高中水平以上的理解能力，可以在很多地方上逐渐替代人类的角色来实现完全的自动化处理任务。</p> <blockquote><p>资源类别</p></blockquote> <p>资源类别是指一组具有共同特征的资源集合。例如我们说老师这个资源或销售这个资源类别。</p> <p>常见的资源类别可以基于下面几种方式来定义：</p> <ul><li>角色：基于能够做什么，一般具有相同的技能。</li> <li>组织：基于组织信息，一般在相同的组织架构下。</li></ul> <h2 id="资源分配模式"><a href="#资源分配模式" class="header-anchor">#</a> 资源分配模式</h2> <p>常见的资源分配模式包括创建模式、推模式、拉模式等。下面分别对这几种模式进行介绍：</p> <ul><li><p>创建模式（Creation Patterns）：在创建模式中，<strong>任务的创建者会直接指定任务的执行者</strong>。这种模式适用于明确知道谁负责执行某个任务的情况。创建模式可以实现对任务执行者的精确控制，但缺点是灵活性较差，不适合处理动态变化的任务分配需求。</p> <p>创建模式可以根据任务分配的依据细分为以下几类：</p> <ol><li>直接分配：创建者直接将任务分配给指定的个人。这种方式最为简单，适用于任务执行者固定且明确的情况。</li> <li>角色分配：创建者将任务分配给具有特定角色的人员。这种方式适用于任务需要特定角色的人员来完成，但具体执行者可以灵活选择。</li> <li>组织分配：创建者将任务分配给特定的组或部门。这种方式适用于任务需要由某个组或部门的成员来完成，但具体执行者可以在组内进行协商和调整。</li> <li>职责分离模式：两个任务之间存在一个约束，要求它们在给定的流程实例中不由同一用户执行。例如，签署支票任务不能由完成提交采购订单任务的同一用户来执行。</li> <li>基于能力的分配：根据资源所具备的能力，将任务提供或分配给一个或多个资源。例如，将审计帐户任务分配给具有注册会计师资格的用户。</li> <li>基于历史的分配：根据资源之前的执行历史，将任务提供或分配给一个或多个资源。例如，将审计大客户任务分配给过去三个月中完成最多审计的用户。</li></ol></li> <li><p>推模式（Push Patterns）：推模式下，<strong>引擎会主动将任务分配到资源</strong>。也就是把任务和资源进行匹配，但是资源自身不能选择，一旦一个资源（人）执行完一个任务，就会被引擎立刻分配一个新的任务，类似我们生活中美团送外卖的和滴滴司机的情况。推模式可以实现任务的自动分配，提高工作流的执行效率。然而，这种模式可能导致任务分配不均衡，因为执行者无法主动选择任务，只能被动接受。</p> <p>注意，在这种模式下引擎的操作对象有两个，一个是任务，另一个是资源（人）。所以这里操作分两个步骤：</p> <ul><li>首先是决定要处理哪个任务先，即任务的排队顺序。</li> <li>然后是决定把前面的任务分配给哪个资源，即资源的排队顺序，到这里才是开始推模式。</li></ul> <p>所以推模式下，引擎需要进行任务排队和资源排队，形成两个队列后，再进行分配。</p> <img src="/assets/img/4.4 push模式.8ad6c39e.png" alt="image-20240321183418061" style="zoom:50%;"> <blockquote><p>任务排队原则</p></blockquote> <p>1、先进先出(FIFO)：这是一种最基本的资源分配模式，也被称为先来先服务(FCFS)。简单来说，它就是先到达的任务请求先被处理。这种方式公平且简单，但可能导致某些需要大量资源的请求阻塞后续的小请求。</p> <p>2、后进先出(LIFO)：与FIFO相反，LIFO策略是最后到达的请求先被处理。这种方式在某些情况下可能会导致资源的更高效使用，但也可能导致一些任务请求无限期地等待。</p> <p>3、最短处理时间(SPT)：在这种模式下，处理时间最短的任务请求优先得到服务。这种方式可以最小化总的等待时间和系统中的任务数量，但可能会导致长任务饿死，即长任务永远无法得到处理。</p> <p>4、最短剩余处理时间(SRPT)：这是SPT的一种变体，其中优先级最高的是剩余处理时间最短的任务请求，而不是总的处理时间最短的任务请求。这种方式可以进一步减少等待时间和系统中的任务数量，但同样可能导致长任务饿死。</p> <p>5、最早截止期限(EDD)：在这种模式下，最早截止的任务请求优先得到服务。这种方式在处理有截止期限的任务时非常有效，可以最小化未按时完成的任务数量。然而，它可能导致一些没有截止期限的或截止期限较晚的任务长时间得不到处理。</p> <blockquote><p>资源排队原则</p></blockquote> <ol><li>单一资源分发模式：任务以非强制的方式提供给指定的单一资源。例如，审查反馈任务提供给用户smith，但他们没有义务去完成它。</li> <li>多资源分发模式：任务以非强制的方式提供给多个资源，期望其中一个资源可能会承担起来。例如，流程申请任务提供给管理员角色的成员，尽管他们没有义务去完成它。</li> <li>单一资源分配模式：任务以强制的方式分配给指定的单一资源，并且他们预期在未来的某个时间完成它。</li> <li>随机分配模式：从一组资源中随机选择一个资源分配任务。例如，将流程申请任务随机分配给管理员角色的一个成员。</li> <li>轮流分配模式：从一组资源中按照轮流的方式选择一个资源分配任务。例如，将流程支持请求任务分配给最近最少执行该任务的系统管理员角色的成员。</li> <li>最短队列模式：根据谁的待处理工作最少（即工作队列最短）从一组资源中选择一个资源分配任务。例如，将年度审查任务分配给待处理工作最少的系统管理员角色的成员。</li></ol> <p><em>注意：这里分发是自愿性的，而分配则带有强制性的。</em></p> <p>前面介绍的6种原则都是比较简单的模式，还有一些更加高级的调度算法，例如我们后面会介绍的遗传算法，以及蚁群算法、粒子群算法、模拟退火算法在车间调度问题上的解决。还有一些甚至可以使用深度学习的AI算法来进行调度分配。</p></li> <li><p>拉模式（Pull Patterns）：在拉模式中，任务会被放入一个公共的任务池，合适的执行者可以从任务池中主动领取任务。这种模式允许执行者根据自己的能力和负载情况来选择任务，有利于实现任务的平衡分配。但是，拉模式可能导致任务执行的不确定性，因为任务的领取和完成时间可能受到执行者的主观因素影响。</p> <img src="/assets/img/4.4 pull模式.74bf5121.png" alt="image-20240321183337752" style="zoom:50%;"> <p>资源能够对他们看到和/或可以承担的工作项的顺序施加排序/重新排序。例如，按接收日期顺序重新排序工作项，并选择他们接下来要承担的工作项。即每个资源（人）都有一个工作任务列表，类似像SAP的Work Items。</p> <img src="/assets/img/4.4 sap-work-items.27cd536a.png" alt="Work list – Full screen" style="zoom:67%;"></li> <li><p>自动执行模式（Automatic Execution）：工作项可以在不需要分配给资源的情况下执行。例如，发送订单工作项可以在不需要用户完成的情况下自动执行。</p></li></ul> <p>一般情况下，我们可以采取介于推模式和拉模式之间的方法，采用拉模式，即员工主动领取任务为主。同时用工作流引擎的推模式生成任务的计划安排（甘特图）作为辅助手段。</p> <h2 id="资源调度框架"><a href="#资源调度框架" class="header-anchor">#</a> 资源调度框架</h2> <img src="/assets/img/4 资源调度框架.1ce096db.png" alt="image-20240102094153676" style="zoom:33%;"> <p>输入：</p> <ul><li><p>当前有哪些任务待分配资源</p></li> <li><p>当前有哪些资源可使用</p></li> <li><p>目标：基于成本最优、基于时间最优等</p></li> <li><p>范围：指定角色、组织、技能范围</p> <p>在一个流程中，参与者、角色、技能、组织之间关系的一种结构化模型。这里提到的组织模式，是用于描述参与者（human resources）在流程中的组织结构和关系的模型。</p> <img src="/assets/img/4 组织模式.068658d3.png" alt="image-20240102095401420" style="zoom:50%;"></li></ul> <p>输出：</p> <ul><li>每个任务对应分配了哪个资源</li></ul> <p>引擎的输出其实就是一个甘特图，这个甘特图可以看到过去、现在以及未来所有资源和任务的分配情况。</p> <img src="/assets/img/4.4 gant.a3296be4.gif" style="zoom:67%;"> <p>下面的f就是资源分配的策略：</p> <div class="language- extra-class"><pre class="language-text"><code>f(当前有哪些任务待分配资源,当前有哪些资源可使用，目标，权限) = 哪个任务对应分配了哪个资源
</code></pre></div><p>兑入资源调度系统，每次输入的时候可以看到如下一个二维表，其输出就是根据设定的目标和权限，来把任务分配到具体资源下面。</p> <table><thead><tr><th>资源分配</th> <th>Resource_1</th> <th>Resource_2</th> <th>Resource_3</th> <th>Resource_4</th> <th>Resource_5</th></tr></thead> <tbody><tr><td>Task_1</td> <td></td> <td></td> <td></td> <td></td> <td></td></tr> <tr><td>Task_2</td> <td></td> <td></td> <td></td> <td></td> <td></td></tr> <tr><td>Task_3</td> <td></td> <td></td> <td></td> <td></td> <td></td></tr> <tr><td>Task_4</td> <td></td> <td></td> <td></td> <td></td> <td></td></tr> <tr><td>Task_5</td> <td></td> <td></td> <td></td> <td></td> <td></td></tr></tbody></table> <p>当然，每个任务Task有自身的一些运行时的上下文信息；每个资源也有一些量化的属性，例如平均执行耗时、累计历史执行任务量，所属角色等。</p> <img src="/assets/img/4 资源调度机制.23998b9f.png" alt="image-20231225094705443" style="zoom:67%;"> <p>f调度策略什么时候被唤醒执行：</p> <ul><li><p>每次有新的任务进入待处理任务池</p></li> <li><p>每次资源完成一个任务，重新进入可用资源池</p></li></ul> <h2 id="车间调度问题"><a href="#车间调度问题" class="header-anchor">#</a> 车间调度问题</h2> <p><em><strong>上面提及的资源调度问题，通过进一步分析，本质上其实就是车间调度问题。</strong></em></p> <p>作业车间调度问题（Job Shop Scheduling Problem，JSP）是一类组合优化问题，主要涉及在一个车间或工厂中，有一组作业（jobs）需要在一组机器（machines）上完成一系列任务。每个作业由多个任务组成，而每个任务都必须按照特定的顺序在不同的机器上执行。每个任务有一个预定的处理时间，而每台机器在任意时刻只能处理一个任务。问题的目标是找到一种调度方案，以最小化总体完成时间、最大化生产效率，或者满足其他特定的调度目标。</p> <p>形式化地，作业车间调度问题可以定义如下：</p> <ol><li><strong>有限的机器集合：</strong> 给定一组机器 $M = {M_1, M_2, ..., M_m}。</li> <li><strong>有限的作业集合：</strong> 给定一组作业 $J = {J_1, J_2, ..., J_n}。</li> <li><strong>每个作业包含多个任务：</strong> 每个作业 $J_i 由一系列任务 O_{i1}, O_{i2}, ..., O_{ip} 组成。</li> <li><strong>每个任务具有处理时间：</strong> 每个任务 O_{ij} 在机器上需要一定的处理时间 p_{ij}。</li> <li><strong>机器约束：</strong> 每台机器在任意时刻只能执行一个任务。</li></ol> <p>问题的目标是找到一个合理的调度，使得所有作业的完成时间最小。完成时间可以是作业的总加权完成时间、最大完成时间等，具体取决于问题的特定要求。由于作业车间调度问题属于 NP-难问题，通常需要使用启发式算法或其他优化技术来找到接近最优解的调度方案。</p> <p>通过上面车间调度问题的定义，我们可以发现流程中的资源调度问题本质上就是车间调度问题，只不过作业变成了流程、机器变成了资源（例如人），且作业跟流程一样其内的任务是有先后顺序的。不同的机器设备对应着流程中不同角色/组织/技能的资源。而任务的预定处理时间，就是流程中任务的平均处理时间（通过历史计算），两者的目标都是为了最小化完成时间。</p> <p>如下是一个简化的例子，假设存在三个资源（R_1、R_2、R_3），以及三个流程（流程_1、流程_2、流程_3）。每个流程包含三个任务，需要分配不同的资源执行，其中每个任务都有预定的平均处理时间：</p> <img src="/assets/img/4 车间调度-1.1a445315.png" alt="image-20240102154511227" style="zoom:50%;"> <p>每个任务的加工顺序和需要的资源类型如下表所示：</p> <table><thead><tr><th></th> <th>顺序 1</th> <th>顺序 2</th> <th>顺序 3</th></tr></thead> <tbody><tr><td>流程_1</td> <td>R_3</td> <td>R_1</td> <td>R_2</td></tr> <tr><td>流程_2</td> <td>R_2</td> <td>R_3</td> <td>R_1</td></tr> <tr><td>流程_3</td> <td>R_2</td> <td>R_1</td> <td>R_3</td></tr></tbody></table> <p>下表是每个流程的任务在3个资源上处理的耗时：</p> <table><thead><tr><th></th> <th>R_1耗时/h</th> <th>R_2耗时/h</th> <th>R_3耗时/h</th></tr></thead> <tbody><tr><td>流程_1</td> <td>4</td> <td>2</td> <td>7</td></tr> <tr><td>流程_2</td> <td>3</td> <td>5</td> <td>6</td></tr> <tr><td>流程_3</td> <td>2</td> <td>4</td> <td>3</td></tr></tbody></table> <p>如下是调度的Gant图：</p> <img src="/assets/img/4 车间调度-0.463f27c8.png" alt="image-20240102193708608" style="zoom:67%;"> <p>在t=0h时刻，甘特图、任务池和资源池如下所示。这时Task(2,1)和Task(3,1)都需要资源2(R_2)执行，但是由于资源同一时刻只能执行一个任务，所以在t=0h时刻只有2个任务在执行。</p> <img src="/assets/img/4 车间调度-2.ee3d3cbd.png" alt="image-20240102155232187" style="zoom:67%;"> <p>在t=5h时刻，这时Task(2,1)已经执行完，接着Task(2,2)进入任务池，同时资源R_2空闲出来也进入资源池，而资源R3由于还在执行Task(1,1)任务所以还在占用状态。此时资源池可用资源就有资源R_1和R_2，任务池待处理的有Task(2,2)和Task(3,1)。由于Task(2,2)需要资源R_3来执行，所以这次没有分配到资源。而任务Task(3,1)需要的资源R_2空闲，则可以分配执行。</p> <img src="/assets/img/4 车间调度-3.1dc2253c.png" alt="image-20240102155512572" style="zoom:67%;"> <p>在t=7h时刻，此时任务Task(1,1)结束，接着的Task(1,2)任务进入任务池，同时资源R_3释放出来进入资源池。</p> <p>此时任务池有Task(1,2)和上一次未被执行的Task(2,2)，资源池有资源R_1和R_3。</p> <p>而Task(1,2)需要资源R_1，Task(2,2)需要资源R_3，刚好两者都空闲，可以分配执行。</p> <img src="/assets/img/4 车间调度-4.f9198cc3.png" alt="image-20240102155845939" style="zoom:67%;"> <p>在t=9h时刻，任务Task(3,1)结束，接着Task(3,2)进入任务池，此时R_2资源释放进入资源池。</p> <p>此时任务池有Task(3,2)，资源池有R_2。</p> <p>但是由于Task(3,2)需要资源R_1来执行，而此时R_1正在执行Task(1,2)，所以无法分配执行。</p> <img src="/assets/img/4 车间调度-5.ee3ab03e.png" alt="image-20240102160145027" style="zoom:67%;"> <p>在t=11h时刻，任务Task(1,2)结束，接着的Task(1,3)进入任务池，资源R_1释放进入资源池。</p> <p>此时任务池有Task(1,3)和Task(3,2)，资源池有R_1和R_2。</p> <p>而Task(1,3)需要资源R_2，Task(3,2)需要资源R_1，两者正好匹配可以执行。</p> <img src="/assets/img/4 车间调度-6.5008853f.png" alt="image-20240102160345778" style="zoom:67%;"> <p>在t=13h时刻，此时Task(3,2)、Task(1,3)、Task(2,2)都结束，接着的Task(3,3)、Task(2,3)进入任务池，资源R_1、R_2和R_3都释放进入资源池。</p> <p>而Task(2,3)需要资源R_1，Task(3,3)需要资源R_3，两者正好匹配可以执行。</p> <img src="/assets/img/4 车间调度-7.0b3add9d.png" alt="image-20240102160601824" style="zoom:67%;"> <p>在t=16h时刻，此时所有任务都结束，任务池为空，资源都释放进入资源池。</p> <img src="/assets/img/4 车间调度-8.3c805252.png" alt="image-20240102160822042" style="zoom:67%;"> <p>车间调度问题被证明是属于NP难问题，是数学界公认的最困难的组合优化问题之一，要获得最优解是非常困难的。所以在实际工程实践中，最好的做法是放弃寻找最优解，转而试图在合理、有限的时间内寻找到一个近似的、有用的局部最优解，例如：模拟退火、遗传算法、神经网络、深度学习等。</p> <h2 id="资源调度算法"><a href="#资源调度算法" class="header-anchor">#</a> 资源调度算法</h2> <p>由于作业车间调度问题的复杂性，传统的精确求解方法在大规模问题上可能效率低下。因此，启发式算法被广泛应用于解决作业车间调度问题，以寻找近似最优解。</p> <p>启发式算法是一类用于解决复杂优化问题的搜索算法，它们通过模拟自然界的启发式规则或者经验性的知识，寻找问题的近似最优解。与传统的精确算法不同，启发式算法通常在可接受的计算时间内，以近似的方式找到解决方案，尤其在面对大规模、高维度或非线性的优化问题时表现出色。</p> <p>一些常见的启发式算法包括：</p> <ul><li><strong>遗传算法（Genetic Algorithms）：</strong> 模拟生物进化过程，通过交叉、变异等操作产生新的解。</li> <li><strong>模拟退火算法（Simulated Annealing）：</strong> 模拟物质退火过程，以概率的方式接受比当前解更差的解，有助于跳出局部最优。</li> <li><strong>粒子群优化算法（Particle Swarm Optimization）：</strong> 模拟群体中个体的协作和信息传递，通过更新个体的位置来搜索最优解。</li> <li><strong>蚁群算法（Ant Colony Optimization）：</strong> 模拟蚂蚁在寻找食物过程中的信息传递和路径选择，用于解决路径规划等问题。</li></ul> <h3 id="遗传算法"><a href="#遗传算法" class="header-anchor">#</a> 遗传算法</h3> <p>遗传算法（Genetic Algorithm，简称GA）是一种受自然选择和遗传学理论启发的优化算法。它模拟了生物进化的过程，通过对个体的遗传信息进行进化和交叉，以产生更好的解决方案。遗传算法主要用于解决搜索和优化问题，特别是那些复杂、多变的问题，如组合优化、参数优化、机器学习等领域。</p> <p>以下是遗传算法的基本步骤：</p> <ol><li><strong>初始化种群：</strong> 随机生成一组个体，每个个体都是问题的一个可能解。</li> <li><strong>适应度评估：</strong> 对每个个体计算其适应度，即解决问题的质量。适应度函数根据问题的性质而定，通常是目标函数的值。</li> <li><strong>选择：</strong> 通过某种选择策略，选择适应度较高的个体作为父代，用于产生下一代。</li> <li><strong>交叉：</strong> 随机选择一对父代个体，通过交叉操作产生子代。交叉操作模拟了基因的重组过程。</li> <li><strong>变异：</strong> 对子代进行变异操作，以引入新的遗传信息。变异操作模拟了基因发生突变的情况。</li> <li><strong>替换：</strong> 用新生成的子代替代老一代，形成新的种群。</li> <li><strong>重复：</strong> 重复上述步骤直到达到停止条件，如达到最大迭代次数或找到满足要求的解。</li></ol> <p>如下图所示是遗传算法的关键流程，其中<strong>编码</strong>（Encoding）和<strong>解码</strong>（Decoding）是两个关键步骤，它们分别用于将问题的解表示成染色体串（Chromosome）和从染色体中提取出问题的解。</p> <ul><li>编码：编码是将问题的解（Solution）转换为染色体的过程，它是将问题的解空间映射到遗传算法的搜索空间。编码的目的是为了实现交叉、变异等类似生物界的遗传操作。必须考虑染色体的合法性、可行性、有效性，以及对问题解空间表达的完全性。良好的编码方式在后续遗传操作中易产生可行解，提高执行效率。</li> <li>解码：解码是从染色体中提取出问题的解的过程。它是编码过程的逆向操作。当遗传算法找到一个可能的解（即染色体）时，需要将这个染色体解码为实际的问题解。解码过程需要确保解码出的解在问题的解空间中是有效的。</li></ul> <img src="/assets/img/4 遗传算法流程说明.c04ca334.png" alt="image-20240109091701719" style="zoom:50%;"> <p>遗传算法的优势在于能够在大规模、复杂的搜索空间中找到全局最优解或接近最优解。它灵活适用于不同类型的问题，并且相对于一些传统的优化算法更具鲁棒性。</p> <p>遗传算法的应用领域包括但不限于：</p> <ul><li>组合优化问题：如旅行商问题（TSP）、背包问题等。</li> <li>函数优化：寻找函数的最大或最小值。</li> <li>机器学习：参数优化、特征选择等。</li> <li>调度问题：优化任务分配和资源调度。</li> <li>进化计算：模拟生物进化过程，用于生成人工生命体等。</li></ul> <p>如下是4个流程以及流程中各个任务需要的资源，接下来，我们使用遗传算法来对这些任务和资源进行合理分配，得到一个总耗时最小时间的调度计划。</p> <img src="/assets/img/4-资源调度-4个流程和资源的关系.b1e37ee9.png" alt="image-20240111085221651" style="zoom:50%;"> <p>根据前面遗传算法的介绍，一个遗传算法有以下几个关键的步骤：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">GA</span><span class="token punctuation">:</span>
  <span class="token comment"># 初始化参数</span>
  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
  <span class="token comment"># 初始化种群</span>
	<span class="token keyword">def</span> <span class="token function">init_population</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
  
  <span class="token comment"># 适应度评估</span>
  <span class="token keyword">def</span> <span class="token function">get_fitness</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
  
  <span class="token comment"># 选择</span>
  <span class="token keyword">def</span> <span class="token function">select</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
  
  <span class="token comment"># 交叉</span>
  <span class="token keyword">def</span> <span class="token function">crossover</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
  
  <span class="token comment"># 变异</span>
  <span class="token keyword">def</span> <span class="token function">mutate</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
  
  <span class="token comment"># 重复上述过程知道满足条件为止</span>
  <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div><p>接下来，我们一步步来实现上述关键的函数功能。</p> <h4 id="编码"><a href="#编码" class="header-anchor">#</a> 编码</h4> <p>如前所述，资源调度问题包括两个子问题:资源选择和任务排序。</p> <ul><li>资源选择解决每个任务在可选资源集中的哪个资源上进行执行的问题。</li> <li>任务排序解决所有任务确定资源后的排序和开始执行时间问题。</li></ul> <p>在进行后续步骤以前，我们需要对实际问题进行编码操作，转换成遗传算法可以理解执行的染色体，即将实际问题解空间的搜索编码转换成染色体，而每一个染色体即表示问题的一种可能解。</p> <p>下面我们采用任务排序进行编码， 其编码方式如下图所示:</p> <p>染色体编码为:chromosome = ...,wi,wj,wk,...，其中wi代表第i个顺序流程，而流程出现的次数代表流程的第几个任务。</p> <p>例如：chromosome=[1,3,3,3,2,2,2,0,0]中0、1、2、3表示流程的顺序编号，例如我们分别对应上面的#P-01、#P-03、#P-02、#P-00四个流程，并且第几次出现就代表流程的第几个任务。然后将每一次随机生成的染色体个体加入到种群集合中，这个种群中每一个染色体都是问题的解，我们通过适应度来评估每一个染色体。</p> <blockquote><p>例如流程的顺序编号映射关系如下：</p></blockquote> <p>注意：顺序编号跟流程编号的映射关系是在初始化时随机的。</p> <table><thead><tr><th>流程编号</th> <th>#P-01</th> <th>#P-03</th> <th>#P-02</th> <th>#P-00</th></tr></thead> <tbody><tr><td>顺序编号</td> <td>0</td> <td>1</td> <td>2</td> <td>3</td></tr></tbody></table> <blockquote><p>例如染色体编码的映射关系：</p></blockquote> <table><thead><tr><th>染色体</th> <th>1</th> <th>3</th> <th>3</th> <th>3</th> <th>2</th> <th>2</th> <th>2</th> <th>0</th> <th>0</th></tr></thead> <tbody><tr><td>流程编号</td> <td>#P-03</td> <td>#P-00</td> <td>#P-00</td> <td>#P-00</td> <td>#P-02</td> <td>#P-02</td> <td>#P-02</td> <td>#P-01</td> <td>#P-01</td></tr> <tr><td>任务编号</td> <td>#T-03-00</td> <td>#T-00-00</td> <td>#T-00-01</td> <td>#T-00-02</td> <td>#T-02-00</td> <td>#T-02-01</td> <td>#T-02-02</td> <td>#T-01-00</td> <td>#T-01-01</td></tr></tbody></table> <p>我们将前面的4个流程转换成如下的数组表示，通过该数组可以知道流程的任务顺序以及每个任务的执行耗时。</p> <div class="language-python extra-class"><pre class="language-python"><code>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-00'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-00-00'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10000'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-00'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-00-01'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10001'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-00'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-00-02'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10002'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-01'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-01-00'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10003'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-01'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-01-01'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10000'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-02'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-02-02'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10001'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-02'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-02-01'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10004'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-02'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-02-00'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10000'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-03'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-03-00'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10004'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>上面的原始数据还需要进一步调用reshape_data方法进行加工，转换成遗传算法能处理的数据形式。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">reshape_data</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> ReshapeData<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    将输入数据转换为遗传算法可以处理的格式，结果包括转换后的数据、流程、资源、任务等信息。
    '''</span>
    <span class="token keyword">def</span> <span class="token function">make_array</span><span class="token punctuation">(</span>r<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> ReshapeData<span class="token punctuation">:</span>

        <span class="token triple-quoted-string string">'''
        变量r的数据结构如下案例所示：
        {
            '#P-00': [
                {'process': '#P-00', 'task': '#T-00-00', 'resource': '#R-10000', 'time': 10, 'order': 0}, 
                {'process': '#P-00', 'task': '#T-00-01', 'resource': '#R-10001', 'time': 21, 'order': 1}, 
                {'process': '#P-00', 'task': '#T-00-02', 'resource': '#R-10002', 'time': 12, 'order': 2}
                ], 
            '#P-01': [
                {'process': '#P-01', 'task': '#T-01-00', 'resource': '#R-10003', 'time': 21, 'order': 0}, 
                {'process': '#P-01', 'task': '#T-01-01', 'resource': '#R-10000', 'time': 21, 'order': 1}
                ], 
            '#P-02': [
                {'process': '#P-02', 'task': '#T-02-02', 'resource': '#R-10001', 'time': 5, 'order': 2}, 
                {'process': '#P-02', 'task': '#T-02-01', 'resource': '#R-10004', 'time': 11, 'order': 1}, 
                {'process': '#P-02', 'task': '#T-02-00', 'resource': '#R-10000', 'time': 10, 'order': 0}
                ], 
            '#P-03': [
                {'process': '#P-03', 'task': '#T-03-00', 'resource': '#R-10004', 'time': 5, 'order': 0}
                ]
        }
        '''</span>
        processs <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> v<span class="token punctuation">:</span> v<span class="token punctuation">[</span><span class="token string">&quot;process&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        resources <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> v<span class="token punctuation">:</span> v<span class="token punctuation">[</span><span class="token string">&quot;resource&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        task <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> processs<span class="token punctuation">]</span>
        

        reverse_processs <span class="token operator">=</span> make_reverse_index<span class="token punctuation">(</span>processs<span class="token punctuation">)</span> <span class="token comment"># 把流程编号跟数组索引id做映射</span>
        reverse_resources <span class="token operator">=</span> make_reverse_index<span class="token punctuation">(</span>resources<span class="token punctuation">)</span> <span class="token comment"># 把资源编号跟数组索引id做映射</span>
        <span class="token triple-quoted-string string">'''
        例如：
        reverse_processs==&gt; &lt;class 'dict'&gt; {'#P-01': 0, '#P-03': 1, '#P-02': 2, '#P-00': 3}
        reverse_resources==&gt; &lt;class 'dict'&gt; {'#R-10002': 0, '#R-10000': 1, '#R-10001': 2, '#R-10004': 3, '#R-10003': 4}
        '''</span>
        ans <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> r<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># 流程个数，这里是4个流程</span>
 
        <span class="token keyword">for</span> process_id<span class="token punctuation">,</span> task_list <span class="token keyword">in</span> r<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># process_id是流程编号，task_list是流程里的任务数组</span>
            <span class="token comment"># m取task_list任务数组中成员order值最大的值</span>
            m <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> v<span class="token punctuation">:</span> v<span class="token punctuation">[</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> task_list<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>task_list<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">else</span> task_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">]</span>
            t <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># t[key] = (v1,t), key为任务的顺序编号，v1为资源顺序编号，t为资源执行任务的耗时</span>
            x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># x[key] = value，key为任务的顺序编号，value为任务编号</span>
            <span class="token keyword">for</span> p <span class="token keyword">in</span> task_list<span class="token punctuation">:</span>
                <span class="token triple-quoted-string string">'''
                p是流程中某一个任务，例如：{'process': '#P-03', 'task': '#T-03-00', 'resource': '#R-10004', 'time': 5, 'order': 0}，
                p[&quot;resource&quot;] = '#R-10004', reverse_resources[p[&quot;resource&quot;]] = reverse_resources['#R-10004'] = 3
                p[&quot;time&quot;] = 5
								p[&quot;order&quot;] = 0
                t[p[&quot;order&quot;]] = (reverse_resources[p[&quot;resource&quot;]], p[&quot;time&quot;]) &lt;==&gt; t[0] = (3,5)
                '''</span>
                t<span class="token punctuation">[</span>p<span class="token punctuation">[</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>reverse_resources<span class="token punctuation">[</span>p<span class="token punctuation">[</span><span class="token string">&quot;resource&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
                x<span class="token punctuation">[</span>p<span class="token punctuation">[</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token string">&quot;task&quot;</span><span class="token punctuation">]</span> 
            x <span class="token operator">=</span> filter_value<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 把key=-1的无效数组成员移除，例如：['#T-03-00', -1, ...]</span>
            t <span class="token operator">=</span> filter_value<span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 把key=-1的无效数组成员移除，例如：[(3,5),-1,....]</span>
            
            ans<span class="token punctuation">[</span>reverse_processs<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> t
            <span class="token triple-quoted-string string">'''
            ans[key] = [(v1,t),....]，其中key是流程的顺序编号，t里的每个成员中，v1为资源顺序编号，t为资源执行任务的耗时
            '''</span>
 
            task<span class="token punctuation">[</span>reverse_processs<span class="token punctuation">[</span>process_id<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> x

        task <span class="token operator">=</span> filter_value<span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 把key=-1的无效数组成员移除，例如：[['#T-03-00'],-1,....]</span>
        <span class="token triple-quoted-string string">'''
        task[key] = [task_list_1,...]，其中key是流程的顺序编号，task_list表示流程对应的任务编号数组
        task==&gt; [
            ['#T-01-00', '#T-01-01'], 
            ['#T-03-00'], 
            ['#T-02-00', '#T-02-01', '#T-02-02'], 
            ['#T-00-00', '#T-00-01', '#T-00-02']
        ]
        '''</span>

        ans <span class="token operator">=</span> filter_value<span class="token punctuation">(</span>ans<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token triple-quoted-string string">'''
        ans就是把所有编号表示转换成二维数组索引方式表示
        ans==&gt; [
            [(4, 21), (1, 21)],            ----&gt;表示顺序编号为0的流程的任务列表，即：#P-01
            [(3, 5)],                      ----&gt;表示顺序编号为1的流程的任务列表，即：#P-03
            [(1, 10), (3, 11), (2, 5)],    ----&gt;表示顺序编号为2的流程的任务列表，即：#P-02
            [(1, 10), (2, 21), (0, 12)]    ----&gt;表示顺序编号为3的流程的任务列表，即：#P-00
        ]        
        一维数组成员的索引跟reverse_processs一一对应
        二维数组成员表示流程的任务在对应资源上的执行耗时，顺序是按照任务的order字段排序
        例如：
        一维数组的第一个索引成员，'#P-01': [
                {'process': '#P-01', 'task': '#T-01-00', 'resource': '#R-10003', 'time': 21, 'order': 0}, 
                {'process': '#P-01', 'task': '#T-01-01', 'resource': '#R-10000', 'time': 21, 'order': 1}
                ]
        则ans中的(4,21)，4表示资源#R-10003，表示流程#P-01的第一个任务#T-01-00在资源#R-10003上执行耗时时21
        '''</span>
        <span class="token keyword">return</span> ReshapeData<span class="token punctuation">(</span>ans<span class="token punctuation">,</span> processs<span class="token punctuation">,</span> resources<span class="token punctuation">,</span> task<span class="token punctuation">,</span> reverse_resources<span class="token punctuation">,</span> reverse_processs<span class="token punctuation">)</span>
 
    <span class="token comment"># 把一维数组转换成按照流程编号分组的对象数组，map[流程编号] = [...]</span>
    result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> value <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        w <span class="token operator">=</span> value<span class="token punctuation">[</span><span class="token string">&quot;process&quot;</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> w <span class="token keyword">in</span> result<span class="token punctuation">:</span>
            result<span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            result<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span>
    
    <span class="token keyword">return</span> make_array<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div><p>首先是GA类对象参数初始化，其中的<code>resource_matrix</code>、<code>time_matrix</code>和<code>task_matrix</code>三个成员变量主要用于辅助遗传算法中的编码和解码操作。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">GA</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> population_size <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">,</span> times <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> cross_rate <span class="token operator">=</span> <span class="token number">0.95</span><span class="token punctuation">,</span>
                 mutation_rate <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">,</span> process_number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> resource_number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>population_size <span class="token operator">=</span> population_size  <span class="token comment"># 种群数量</span>
        self<span class="token punctuation">.</span>times <span class="token operator">=</span> times  <span class="token comment"># 遗传代数</span>
        self<span class="token punctuation">.</span>cross_rate <span class="token operator">=</span> cross_rate  <span class="token comment"># 交叉概率</span>
        self<span class="token punctuation">.</span>mutation_rate <span class="token operator">=</span> mutation_rate  <span class="token comment"># 突变概率</span>
 
        self<span class="token punctuation">.</span>process_number <span class="token operator">=</span> process_number  <span class="token comment"># 流程数量</span>
        self<span class="token punctuation">.</span>resource_number <span class="token operator">=</span> resource_number  <span class="token comment"># 资源数量</span>
        self<span class="token punctuation">.</span>task_number<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 任务数量</span>
        self<span class="token punctuation">.</span>chromosome_size<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 染色体长度 = 所有流程的任务数</span>
 
				<span class="token comment"># self.resource_matrix[i][j]表示第i个顺序流程第j个顺序任务所使用的资源编号</span>
        self<span class="token punctuation">.</span>resource_matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span> 
    
    		<span class="token comment"># self.time_matrix[i][j]表示第i个顺序流程第j个顺序任务所用加工时间</span>
        self<span class="token punctuation">.</span>time_matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span> 
        
        <span class="token comment"># self.task_matrix[i][j]表示第i个流程在第j台资源上的任务编号</span>
        self<span class="token punctuation">.</span>task_matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span> 
 
				<span class="token comment"># 染色体个数，即总群数量</span>
        self<span class="token punctuation">.</span>genes<span class="token punctuation">:</span> Set<span class="token punctuation">[</span>Gene<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre></div><h4 id="初始化种群"><a href="#初始化种群" class="header-anchor">#</a> 初始化种群</h4> <p>初始化完参数以后，接下来就需要对种群进行初始化：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">GA</span><span class="token punctuation">:</span>
  	<span class="token comment"># 初始化种群 [0, 1, 2, 1, 2, 0, 0, 1] =&gt; 12</span>
    <span class="token keyword">def</span> <span class="token function">init_population</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>population_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># step1：初始化染色体</span>
            g <span class="token operator">=</span> Gene<span class="token punctuation">(</span><span class="token punctuation">)</span> 
            size <span class="token operator">=</span> self<span class="token punctuation">.</span>process_number <span class="token operator">*</span> self<span class="token punctuation">.</span>resource_number
            index_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            chromosome <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>process_number<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>resource_number<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    index <span class="token operator">=</span> randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>index_list<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    val <span class="token operator">=</span> index_list<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>index<span class="token punctuation">)</span>

                    <span class="token comment"># self.task_matrix[j][k]表示第j个顺序编号的流程在第k个顺序编号的资源上的任务编号</span>
                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>task_matrix<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                        chromosome<span class="token punctuation">[</span>val<span class="token punctuation">]</span> <span class="token operator">=</span> j 
            g<span class="token punctuation">.</span>chromosome <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> chromosome<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#移除染色体chromosome中无效的成员-1</span>
            
            <span class="token comment"># step2：计算染色体的适应度</span>
            g<span class="token punctuation">.</span>fitness <span class="token operator">=</span> self<span class="token punctuation">.</span>get_fitness<span class="token punctuation">(</span>g<span class="token punctuation">)</span>
            
            <span class="token comment"># step3：染色体添加到种群</span>
            self<span class="token punctuation">.</span>genes<span class="token punctuation">.</span>add<span class="token punctuation">(</span>g<span class="token punctuation">)</span>
</code></pre></div><h4 id="适应度评估"><a href="#适应度评估" class="header-anchor">#</a> 适应度评估</h4> <p>前面初始化种群时，要计算每个染色体的适应度，如下是染色体适应度的计算，在计算前，需要将染色体解码成实际的问题，用实际的问题来评估适应度。</p> <p>这里我们是执行总耗时多少来评估适应度，执行越耗时，则适应度越低，呈倒数关系。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 存储解码结果</span>
<span class="token keyword">class</span> <span class="token class-name">GeneEvaluation</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fulfill_time <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>resource_work_time <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>task_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>end_time <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>start_time <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>MATRIX_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">GA</span><span class="token punctuation">:</span>
    <span class="token comment"># 适应度评估</span>
    <span class="token keyword">def</span> <span class="token function">get_fitness</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> g<span class="token punctuation">:</span> Gene<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        执行总耗时越多，适应度越低，是倒数关系
        '''</span>
        <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>translate_gene<span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">.</span>fulfill_time
    
    <span class="token comment"># 计算当前染色体的执行总耗时</span>
    <span class="token keyword">def</span> <span class="token function">translate_gene</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> g<span class="token punctuation">:</span> Gene<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> GeneEvaluation<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        计算当前染色体的执行总耗时
        '''</span>
        evaluation <span class="token operator">=</span> GeneEvaluation<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> process_seq_id <span class="token keyword">in</span> g<span class="token punctuation">.</span>chromosome<span class="token punctuation">:</span>
            <span class="token comment"># process_seq_id表示流程的顺序编号</span>
            <span class="token comment"># task_seq_id表示任务的顺序编号</span>
            <span class="token comment"># resource_seq_id表示资源的顺序编号</span>
            <span class="token comment"># resource_work_time表示当前资源处理所处的时间</span>
            
            <span class="token triple-quoted-string string">'''
            当前process_seq_id个流程是第task_seq_id个任务。
            计算某个流程的第一个任务时，task_seq_id=0，
            计算某个流程的第二个任务时，task_seq_id=1，即依次自增长处理
            '''</span>
            task_seq_id <span class="token operator">=</span> evaluation<span class="token punctuation">.</span>task_ids<span class="token punctuation">[</span>process_seq_id<span class="token punctuation">]</span>
            resource_seq_id <span class="token operator">=</span> self<span class="token punctuation">.</span>resource_matrix<span class="token punctuation">[</span>process_seq_id<span class="token punctuation">]</span><span class="token punctuation">[</span>task_seq_id<span class="token punctuation">]</span> <span class="token comment"># 第process_seq_id个流程第task_seq_id个任务所使用的资源编号</span>
            time <span class="token operator">=</span> self<span class="token punctuation">.</span>time_matrix<span class="token punctuation">[</span>process_seq_id<span class="token punctuation">]</span><span class="token punctuation">[</span>task_seq_id<span class="token punctuation">]</span> <span class="token comment"># 第process_seq_id个流程第task_seq_id个任务所用的执行时间</span>
            evaluation<span class="token punctuation">.</span>task_ids<span class="token punctuation">[</span>process_seq_id<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span> <span class="token comment"># 下次处理process_seq_id流程的第task_seq_id+1个任务</span>
            <span class="token keyword">if</span> task_seq_id <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                evaluation<span class="token punctuation">.</span>start_time<span class="token punctuation">[</span>process_seq_id<span class="token punctuation">]</span><span class="token punctuation">[</span>task_seq_id<span class="token punctuation">]</span> <span class="token operator">=</span> evaluation<span class="token punctuation">.</span>resource_work_time<span class="token punctuation">[</span>resource_seq_id<span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                evaluation<span class="token punctuation">.</span>start_time<span class="token punctuation">[</span>process_seq_id<span class="token punctuation">]</span><span class="token punctuation">[</span>task_seq_id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>evaluation<span class="token punctuation">.</span>end_time<span class="token punctuation">[</span>process_seq_id<span class="token punctuation">]</span><span class="token punctuation">[</span>task_seq_id <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                            evaluation<span class="token punctuation">.</span>resource_work_time<span class="token punctuation">[</span>resource_seq_id<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># resource_work_time其实是资源resource_seq_id执行的结束时间</span>
            evaluation<span class="token punctuation">.</span>resource_work_time<span class="token punctuation">[</span>resource_seq_id<span class="token punctuation">]</span> <span class="token operator">=</span> evaluation<span class="token punctuation">.</span>start_time<span class="token punctuation">[</span>process_seq_id<span class="token punctuation">]</span><span class="token punctuation">[</span>task_seq_id<span class="token punctuation">]</span> <span class="token operator">+</span> time
            evaluation<span class="token punctuation">.</span>end_time<span class="token punctuation">[</span>process_seq_id<span class="token punctuation">]</span><span class="token punctuation">[</span>task_seq_id<span class="token punctuation">]</span> <span class="token operator">=</span> evaluation<span class="token punctuation">.</span>resource_work_time<span class="token punctuation">[</span>resource_seq_id<span class="token punctuation">]</span>
            <span class="token comment"># 最后一个资源执行结束的时间就是当前染色体的执行总耗时</span>
            evaluation<span class="token punctuation">.</span>fulfill_time <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>evaluation<span class="token punctuation">.</span>fulfill_time<span class="token punctuation">,</span> evaluation<span class="token punctuation">.</span>resource_work_time<span class="token punctuation">[</span>resource_seq_id<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> evaluation
</code></pre></div><p>下面的代码片段，即第process_seq_id个流程的task_seq_id任务开始时间，取其上一个task_seq_id-1任务的结束时间和资源resource_id当前所处的时间的最大值</p> <div class="language- extra-class"><pre class="language-text"><code>evaluation.start_time[process_seq_id][task_seq_id] = max(evaluation.end_time[process_seq_id][task_seq_id - 1],
                                            evaluation.resource_work_time[resource_seq_id])
</code></pre></div><p>例如下面，当前正在计算<code>#T-02-01</code>任务的开始时间，则由于<code>#T-02-01</code>在资源<code>#R-10001</code>上执行，而当前资源<code>#R-10001</code>所处时间是刚执行完<code>#T-00-01</code>（即evaluation.resource_work_time[resource_seq_id]），而<code>#T-02-01</code>的上一个任务<code>#T-02-00</code>结束时间较小，所以<code>#T-02-01</code>得开始时间应该取evaluation.resource_work_time[resource_seq_id]。</p> <img src="/assets/img/4.4-translate-gen-1.0b47143c.png" alt="image-20240115125412301" style="zoom:50%;"> <p>如下，如果当前处理的任务<code>#T-02-01</code>，其上一个任务<code>#T-02-00</code>的结束时间比当前资源evaluation.resource_work_time[resource_seq_id]所在时间大，则这是必须等上一个任务执行结束后才开始执行<code>#T-02-01</code>，也就是任务<code>#T-02-01</code>的开始时间取值为上一个任务<code>#T-02-00</code>的结束时间。</p> <img src="/assets/img/4 translate_gene-2.1bb11949.png" alt="image-20240115125422366" style="zoom:50%;"> <p>初始化完种群以后，接下来就需要对种群进行交叉繁衍，即先选择两个父母染色体进行交叉繁衍，这里涉及到select和crossover两个操作。</p> <h4 id="选择"><a href="#选择" class="header-anchor">#</a> 选择</h4> <p>选择（select）操作是根据个体适应度对种群进行筛选，以便优秀的个体有更多的机会进行繁殖。以下是一些常用的遗传算法选择方法：</p> <ol><li>轮盘赌选择：根据个体适应度占总适应度的比例来分配选择概率。适应度较高的个体被选择的概率较大，适应度较低的个体被选择的概率较小。</li> <li>锦标赛选择：从种群中随机选取一定数量的个体，然后选择其中适应度最高的个体。这个过程重复进行，直到选择出足够数量的个体。</li> <li>排序选择：按照个体的适应度对种群进行排序，然后根据排名分配选择概率。适应度排名靠前的个体被选择的概率较大，适应度排名靠后的个体被选择的概率较小。</li> <li>指数选择：与排序选择类似，但是在分配选择概率时采用指数函数，使得适应度较高的个体被选择的概率更大。</li> <li>随机普遍选择：在轮盘赌选择的基础上，采用等间隔的方式选择个体，可以保证选择过程更加公平。</li> <li>标定选择：直接选择适应度排名靠前的一部分个体，舍弃适应度较低的个体。这种方法选择压力较大，可能导致早熟收敛。</li> <li>线性标定选择：与排序选择类似，但是在分配选择概率时采用线性函数，使得适应度较高的个体被选择的概率更大。</li></ol> <p>这里我们采用锦标赛方法。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">GA</span><span class="token punctuation">:</span>
		<span class="token comment"># 选择</span>
    <span class="token keyword">def</span> <span class="token function">select</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        在锦标赛选择中，从种群中随机采样n个个体，然后选择最优的个体进入下一代，只有个体的适应度值优于其他n-1个竞争者时才能赢得锦标赛。所以，这里最差的个体永远不会幸存，而最优的个体在其参与的所有锦标赛中都能获胜。
        '''</span>
        index_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>genes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        index_set <span class="token operator">=</span> <span class="token punctuation">{</span>index_list<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>index_list<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">}</span>
        best_gene <span class="token operator">=</span> Gene<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        i <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> gene <span class="token keyword">in</span> self<span class="token punctuation">.</span>genes<span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token keyword">in</span> index_set<span class="token punctuation">:</span>
                <span class="token keyword">if</span> best_gene<span class="token punctuation">.</span>fitness <span class="token operator">&lt;</span> gene<span class="token punctuation">.</span>fitness<span class="token punctuation">:</span>
                    best_gene <span class="token operator">=</span> gene
            i <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> best_gene
</code></pre></div><h4 id="交叉"><a href="#交叉" class="header-anchor">#</a> 交叉</h4> <p>选出两个优秀的父母个体以后，接下来就进行交叉染色体进行繁衍：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">GA</span><span class="token punctuation">:</span>
		<span class="token comment"># 交叉</span>
    <span class="token keyword">def</span> <span class="token function">crossover</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> g1<span class="token punctuation">:</span> Gene<span class="token punctuation">,</span> g2<span class="token punctuation">:</span> Gene<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">tuple</span><span class="token punctuation">:</span>
        chromosome_size <span class="token operator">=</span> self<span class="token punctuation">.</span>chromosome_size
 
        <span class="token keyword">def</span> <span class="token function">gene_generate</span><span class="token punctuation">(</span>father<span class="token punctuation">:</span> Gene<span class="token punctuation">,</span> mother<span class="token punctuation">:</span> Gene<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Gene<span class="token punctuation">:</span>
            <span class="token comment"># step1:首先随机产生一个起始位置start和终止位置end</span>
            index_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>chromosome_size<span class="token punctuation">)</span><span class="token punctuation">)</span>
            p1 <span class="token operator">=</span> index_list<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>index_list<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            p2 <span class="token operator">=</span> index_list<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>index_list<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            start <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span>
            end <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span>

            <span class="token comment"># step2:并由从father的染色体序列从start到end的序列中产生一个子代原型</span>
            prototype <span class="token operator">=</span> father<span class="token punctuation">.</span>chromosome<span class="token punctuation">[</span>start<span class="token punctuation">:</span> end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>

            <span class="token comment"># step3:将mother中不包含在child prototype的其余编码加入到child prototype两侧</span>
            t <span class="token operator">=</span> mother<span class="token punctuation">.</span>chromosome<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> v1 <span class="token keyword">in</span> prototype<span class="token punctuation">:</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> v1 <span class="token operator">==</span> t<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
                        t<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
                        <span class="token keyword">break</span>
            child <span class="token operator">=</span> Gene<span class="token punctuation">(</span><span class="token punctuation">)</span>
            child<span class="token punctuation">.</span>chromosome <span class="token operator">=</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span> start<span class="token punctuation">]</span> <span class="token operator">+</span> prototype <span class="token operator">+</span> t<span class="token punctuation">[</span>start<span class="token punctuation">:</span><span class="token punctuation">]</span>
            child<span class="token punctuation">.</span>fitness <span class="token operator">=</span> self<span class="token punctuation">.</span>get_fitness<span class="token punctuation">(</span>child<span class="token punctuation">)</span>
            <span class="token keyword">return</span> child
 
        <span class="token keyword">return</span> gene_generate<span class="token punctuation">(</span>g1<span class="token punctuation">,</span> g2<span class="token punctuation">)</span><span class="token punctuation">,</span> gene_generate<span class="token punctuation">(</span>g2<span class="token punctuation">,</span> g1<span class="token punctuation">)</span>
</code></pre></div><img src="/assets/img/4.4-染色体交叉.aa6a422c.png" alt="image-20240115131614368" style="zoom:50%;"> <h4 id="变异"><a href="#变异" class="header-anchor">#</a> 变异</h4> <p>在这里，我们从染色体中随机选择两个位置选择进行交换来模拟变异行为。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">GA</span><span class="token punctuation">:</span>
		<span class="token comment"># 变异</span>
    <span class="token keyword">def</span> <span class="token function">mutate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> g<span class="token punctuation">:</span> Gene<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        index_list <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>chromosome_size<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token comment"># 从染色体中随机产生两个位置并交换这两个位置的值</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> index_list<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>index_list<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            b <span class="token operator">=</span> index_list<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>index_list<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            g<span class="token punctuation">.</span>chromosome<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>chromosome<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> g<span class="token punctuation">.</span>chromosome<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>chromosome<span class="token punctuation">[</span>a<span class="token punctuation">]</span>
 
        g<span class="token punctuation">.</span>fitness <span class="token operator">=</span> self<span class="token punctuation">.</span>get_fitness<span class="token punctuation">(</span>g<span class="token punctuation">)</span>
</code></pre></div><h4 id="主函数"><a href="#主函数" class="header-anchor">#</a> 主函数</h4> <p>run函数是GA类的调用入口：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">GA</span><span class="token punctuation">:</span>
		<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parameter<span class="token punctuation">:</span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Tuple<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> GeneEvaluation<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        例如： parameter==&gt; [
            [(0, 5)], 
            [(3, 10), (2, 21), (4, 12)], 
            [(3, 10), (0, 11), (2, 5)], 
            [(1, 21), (3, 21)]
        ]
        parameter就是ans二维数组
        '''</span>
        process_size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>process_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># parameter[i]表示任务数组，记录了每个任务在资源上的执行耗时，即（资源顺序编号，执行耗时）</span>
            self<span class="token punctuation">.</span>chromosome_size <span class="token operator">+=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>parameter<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 所有任务的数量就是染色体大小</span>
            <span class="token comment"># 取所有流程里面任务数量最多的作为最大值</span>
            self<span class="token punctuation">.</span>task_number <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_number<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>parameter<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>parameter<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
              	<span class="token comment"># self.resource_matrix[i][j]表示第i个流程的第j个任务的资源顺序编号</span>
                self<span class="token punctuation">.</span>resource_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> parameter<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> 
                <span class="token comment"># self.time_matrix[i][j]表示第i个流程的第j个任务所在资源的执行耗时</span>
                self<span class="token punctuation">.</span>time_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> parameter<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> 
 
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>process_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_number<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>resource_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            				<span class="token comment"># i表示第i个流程，j表示第j个任务，self.resource_matrix[i][j]表示资源的顺序编号</span>
              			<span class="token comment"># 则task_matrix表示在第i个顺序流程，第x个资源上的任务顺序编号</span>
                    self<span class="token punctuation">.</span>task_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>resource_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> j 
 
        self<span class="token punctuation">.</span>init_population<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>times<span class="token punctuation">)</span><span class="token punctuation">:</span>
            probability <span class="token operator">=</span> randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span>
            <span class="token comment"># 控制变异概率</span>
            <span class="token keyword">if</span> probability <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>mutation_rate<span class="token punctuation">:</span>
                index <span class="token operator">=</span> randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>genes<span class="token punctuation">)</span><span class="token punctuation">)</span>
                i <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">for</span> gene <span class="token keyword">in</span> self<span class="token punctuation">.</span>genes<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> i <span class="token operator">==</span> index<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>mutate<span class="token punctuation">(</span>gene<span class="token punctuation">)</span> <span class="token comment"># 变异</span>
                        <span class="token keyword">break</span>
                    i <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                g1<span class="token punctuation">,</span> g2 <span class="token operator">=</span> self<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span>
                children <span class="token operator">=</span> self<span class="token punctuation">.</span>crossover<span class="token punctuation">(</span>g1<span class="token punctuation">,</span> g2<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>genes<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">*</span>children<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment"># 修改总群染色体，新染色体则添加，重复则忽略。</span>
 
        best_gene <span class="token operator">=</span> Gene<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> gene <span class="token keyword">in</span> self<span class="token punctuation">.</span>genes<span class="token punctuation">:</span>
            <span class="token keyword">if</span> best_gene<span class="token punctuation">.</span>fitness <span class="token operator">&lt;</span> gene<span class="token punctuation">.</span>fitness<span class="token punctuation">:</span>
                best_gene <span class="token operator">=</span> gene
 
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>translate_gene<span class="token punctuation">(</span>best_gene<span class="token punctuation">)</span> <span class="token comment"># 解码</span>
</code></pre></div><p>调度函数，其中ResultData用于存储执行的结果。其中fulfill_time是遗传算法返回的最终执行耗时，row_data返回了每个任务在哪个资源以及什么时候执行，gant_data返回以资源视角的甘特图。</p> <div class="language-python extra-class"><pre class="language-python"><code>ResultData <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">&quot;ResultData&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;fulfill_time&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;row_data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gant_data&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 
<span class="token comment"># 输出结果</span>
<span class="token keyword">def</span> <span class="token function">schedule</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> ResultData<span class="token punctuation">:</span>
    reshape <span class="token operator">=</span> reshape_data<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    parameter <span class="token operator">=</span> reshape<span class="token punctuation">.</span>result
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>reshape<span class="token punctuation">.</span>process<span class="token punctuation">)</span>
    m <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>reshape<span class="token punctuation">.</span>resource<span class="token punctuation">)</span>  <span class="token comment"># number from 0</span>
    ga <span class="token operator">=</span> GA<span class="token punctuation">(</span>process_number <span class="token operator">=</span> n<span class="token punctuation">,</span> resource_number <span class="token operator">=</span> m<span class="token punctuation">)</span>
    result <span class="token operator">=</span> ga<span class="token punctuation">.</span>run<span class="token punctuation">(</span>parameter<span class="token punctuation">)</span>
    p <span class="token operator">=</span> ga<span class="token punctuation">.</span>task_number
    resource_matrix <span class="token operator">=</span> ga<span class="token punctuation">.</span>resource_matrix
    row_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> resource_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                temp <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;process&quot;</span><span class="token punctuation">:</span> reshape<span class="token punctuation">.</span>process<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;task&quot;</span><span class="token punctuation">:</span> reshape<span class="token punctuation">.</span>task<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;resource&quot;</span><span class="token punctuation">:</span> reshape<span class="token punctuation">.</span>resource<span class="token punctuation">[</span>resource_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;startTime&quot;</span><span class="token punctuation">:</span> result<span class="token punctuation">.</span>start_time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;endTime&quot;</span><span class="token punctuation">:</span> result<span class="token punctuation">.</span>end_time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
                row_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
 
    gant_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> resource_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                temp <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;process&quot;</span><span class="token punctuation">:</span> reshape<span class="token punctuation">.</span>process<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;task&quot;</span><span class="token punctuation">:</span> reshape<span class="token punctuation">.</span>task<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;startTime&quot;</span><span class="token punctuation">:</span> result<span class="token punctuation">.</span>start_time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;endTime&quot;</span><span class="token punctuation">:</span> result<span class="token punctuation">.</span>end_time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
                m <span class="token operator">=</span> reshape<span class="token punctuation">.</span>resource<span class="token punctuation">[</span>resource_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span>
                <span class="token keyword">if</span> m <span class="token keyword">not</span> <span class="token keyword">in</span> gant_data<span class="token punctuation">:</span>
                    gant_data<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>temp<span class="token punctuation">]</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    gant_data<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
    <span class="token keyword">return</span> ResultData<span class="token punctuation">(</span>result<span class="token punctuation">.</span>fulfill_time<span class="token punctuation">,</span> row_data<span class="token punctuation">,</span> gant_data<span class="token punctuation">)</span>
</code></pre></div><p>为了更好理解生成的调度计划，我们通过甘特图来表示：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 绘制资源甘特图</span>
<span class="token keyword">def</span> <span class="token function">show_gant</span><span class="token punctuation">(</span>gant_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Gant Graph'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>minorticks_on<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
    
    idx_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">]</span>
    labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'#R-10004'</span><span class="token punctuation">,</span> <span class="token string">'#R-10003'</span><span class="token punctuation">,</span> <span class="token string">'#R-10002'</span><span class="token punctuation">,</span> <span class="token string">'#R-10001'</span><span class="token punctuation">,</span> <span class="token string">'#R-10000'</span><span class="token punctuation">]</span>
    ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span>idx_list<span class="token punctuation">,</span> labels<span class="token operator">=</span>labels<span class="token punctuation">)</span>
    color <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'#P-00'</span><span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
        <span class="token string">'#P-01'</span><span class="token punctuation">:</span> <span class="token string">'green'</span><span class="token punctuation">,</span>
        <span class="token string">'#P-02'</span><span class="token punctuation">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span>
        <span class="token string">'#P-03'</span><span class="token punctuation">:</span> <span class="token string">'orange'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    y <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> res <span class="token keyword">in</span> labels<span class="token punctuation">:</span>
        task_list <span class="token operator">=</span> gant_data<span class="token punctuation">[</span>res<span class="token punctuation">]</span>
        y <span class="token operator">+=</span> <span class="token number">10</span>
        xranges <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        facecolors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> v <span class="token keyword">in</span> task_list<span class="token punctuation">:</span>
            length <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token string">'endTime'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token string">'startTime'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            xranges<span class="token punctuation">.</span>append<span class="token punctuation">(</span> <span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token string">'startTime'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span> <span class="token punctuation">)</span>
            facecolors<span class="token punctuation">.</span>append<span class="token punctuation">(</span> <span class="token string">'tab:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>color<span class="token punctuation">[</span>v<span class="token punctuation">[</span><span class="token string">'process'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
        ax<span class="token punctuation">.</span>broken_barh<span class="token punctuation">(</span>xranges<span class="token punctuation">,</span> <span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> facecolors<span class="token operator">=</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>facecolors<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    
    plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>下面，我们以前面的3个流程进行测试：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token comment"># 测试数据</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-00'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-00-00'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10000'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-00'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-00-01'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10001'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-00'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-00-02'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10002'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-01'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-01-00'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10003'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-01'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-01-01'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10000'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-02'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-02-02'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10001'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-02'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-02-01'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10004'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-02'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-02-00'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10000'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

         <span class="token punctuation">{</span><span class="token string">'process'</span><span class="token punctuation">:</span> <span class="token string">'#P-03'</span><span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'#T-03-00'</span><span class="token punctuation">,</span> <span class="token string">'resource'</span><span class="token punctuation">:</span> <span class="token string">'#R-10004'</span><span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'order'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
    resultData <span class="token operator">=</span> schedule<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'fulfill_time==&gt;'</span><span class="token punctuation">,</span>resultData<span class="token punctuation">.</span>fulfill_time<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'row_data==&gt;'</span><span class="token punctuation">,</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>resultData<span class="token punctuation">.</span>row_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'gant_data==&gt;'</span><span class="token punctuation">,</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>resultData<span class="token punctuation">.</span>gant_data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 资源甘特图</span>

    show_gant<span class="token punctuation">(</span>resultData<span class="token punctuation">.</span>gant_data<span class="token punctuation">)</span>
</code></pre></div><p>下面是运行的结果：</p> <img src="/assets/img/4 资源甘特图.8102e22e.png" alt="image-20240111085914836" style="zoom:67%;"> <h3 id="蚁群算法"><a href="#蚁群算法" class="header-anchor">#</a> 蚁群算法</h3> <p>待补充</p> <h3 id="粒子群算法"><a href="#粒子群算法" class="header-anchor">#</a> 粒子群算法</h3> <p>待补充</p> <h3 id="模拟退火算法"><a href="#模拟退火算法" class="header-anchor">#</a> 模拟退火算法</h3> <p>待补充</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">9/12/2024, 11:20:51 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/4.3-工作流模式-控制流模式.html" class="prev">
        4.3 工作流模式-控制流模式
      </a></span> <span class="next"><a href="/4.5-数据管理机制-数据模式.html">
        4.5 数据管理机制-数据模式
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b8820ad2.js" defer></script><script src="/assets/js/2.a6c4a04f.js" defer></script><script src="/assets/js/1.04b49174.js" defer></script><script src="/assets/js/13.9964bf6f.js" defer></script>
  </body>
</html>
